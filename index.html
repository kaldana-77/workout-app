<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Power Up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2c7be5" />
  <link rel="apple-touch-icon" href="wk-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root{
      --bg:#f5f6f8;
      --card:#ffffff;
      --text:#101828;
      --muted:#667085;
      --line:#EAECF0;
      --brand:#2c7be5;
      --ok:#12B76A;
      --danger:#e11d48;

      /* ‚Äútighter / sleeker‚Äù */
      --radius:16px;
      --radius-sm:12px;
      --shadow:0 10px 24px rgba(16,24,40,.08);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:var(--bg);
      color:var(--text);
    }

    header{
      max-width:900px;
      margin:0 auto;
      padding:18px 16px 10px;
    }

    h1{
      margin:0;
      font-size:34px;
      letter-spacing:.2px;
      line-height:1.1;
      font-weight:900;
    }
    .titleEmoji{font-size:.78em; margin-left:8px}
    .sub{margin:6px 0 4px; color:var(--muted); font-weight:650}
    .dateLine{color:var(--muted); font-weight:650}

    .wrap{
      max-width:900px;
      margin:0 auto;
      padding:12px 16px 90px;
    }

    /* Tabs */
    .tabbar{
      margin-top:14px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px;
      display:flex;
      gap:6px;
      box-shadow:0 6px 14px rgba(16,24,40,.06);
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .tab{
      flex:1 0 auto;
      text-align:center;
      font-weight:850;
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      color:var(--muted);
      white-space:nowrap;
    }
    .tab.active{
      background:var(--brand);
      color:#fff;
      box-shadow:0 10px 22px rgba(44,123,229,.22);
    }

    /* Cards */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      margin-top:12px;
    }

    .topRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    h2{
      margin:0;
      font-size:22px;
      font-weight:950;
    }
    .hint{margin:6px 0 0; color:var(--muted); font-weight:650}

    .rightTools{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:9px 11px;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background:var(--brand);
      border-color:var(--brand);
      color:#fff;
    }
    .btn.danger{
      background:rgba(225,29,72,.10);
      border-color:rgba(225,29,72,.25);
      color:var(--danger);
    }

    .allDone{
      border:1px solid rgba(18,183,106,.25);
      background:rgba(18,183,106,.10);
      color:var(--ok);
      padding:6px 10px;
      border-radius:999px;
      font-weight:950;
      display:none;
      white-space:nowrap;
    }

    /* Day chips */
    .days{
      display:flex;
      gap:8px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid var(--line);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      font-weight:850;
      cursor:pointer;
      color:var(--muted);
      user-select:none;
      min-width:56px;
      text-align:center;
    }
    .chip.active{
      border-color: rgba(44,123,229,.25);
      background: rgba(44,123,229,.10);
      color: var(--brand);
    }

    /* Exercise blocks */
    .ex{
      border:1px solid var(--line);
      border-radius:14px;      /* tighter than before */
      padding:12px;
      margin-top:10px;
    }

    .exHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .exName{
      font-weight:950;
      font-size:18px;
      margin:0;
    }
    .exMeta{
      margin:4px 0 0;
      color:var(--muted);
      font-weight:700
    }

    .doneBtn{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:9px 10px;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .doneBtn.checked{
      border-color: rgba(44,123,229,.25);
      background: rgba(44,123,229,.10);
      color: var(--brand);
    }
    .doneBox{
      width:20px; height:20px;
      border-radius:6px;
      border:2px solid #98A2B3;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      color:#fff;
      background:#fff;
    }
    .doneBtn.checked .doneBox{
      background: var(--brand);
      border-color: var(--brand);
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:720px){
      .grid2{grid-template-columns:1fr;}
    }
    label{
      display:block;
      font-size:12px;
      font-weight:850;
      color:var(--muted);
      margin-bottom:6px;
    }
    input, textarea, select{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      font-size:14px;
      font-weight:650;
      outline:none;
      background:#fff;
    }
    textarea{min-height:48px; resize:vertical;}

    .resetLink{
      margin-top:12px;
      color:var(--danger);
      font-weight:850;
      cursor:pointer;
      text-decoration:underline;
      display:inline-block;
    }

    .footerNote{
      text-align:center;
      color:var(--muted);
      font-weight:650;
      margin-top:14px;
    }

    /* Progress stats */
    .statGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:12px;
    }
    @media (max-width:720px){
      .statGrid{grid-template-columns:1fr;}
    }
    .stat{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .stat .k{color:var(--muted); font-weight:850; font-size:12px;}
    .stat .v{font-weight:950; font-size:20px; margin-top:4px;}

    /* Reset checklist rows */
    .check{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      margin-top:10px;
    }
    .check input[type="checkbox"]{
      width:18px; height:18px; margin-top:2px;
      accent-color: var(--brand);
    }
    .check .t{font-weight:900;}
    .check .s{margin-top:4px; color:var(--muted); font-weight:650; font-size:13px; line-height:1.35;}

    .subhead{
      margin:0;
      font-size:16px;
      font-weight:950;
    }

    /* Measurements */
    .measGrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:720px){
      .measGrid{grid-template-columns:1fr;}
    }
    .rowBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top:10px;
    }
    .historyRow{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
      margin-top:10px;
    }

    /* Modals */
    .modalBack{
      position:fixed; inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modal{
      width:min(920px, 100%);
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:0 30px 80px rgba(0,0,0,.22);
      padding:14px;
      max-height:85vh;
      overflow:auto;
    }
    .modalTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .modal h3{margin:0; font-size:18px; font-weight:950;}
    .modal p{margin:6px 0 0; color:var(--muted); font-weight:650;}

    .editRow{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      margin-top:10px;
      background:#fff;
    }
    .editGrid{
      display:grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:720px){
      .editGrid{grid-template-columns:1fr;}
    }

    .infoBody{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
      font-weight:650;
      line-height:1.5;
      color:#1f2937;
      white-space:pre-wrap;
    }

    /* Monday pulse */
    @keyframes pulseSoft{
      0%{transform:scale(1);opacity:1}
      50%{transform:scale(1.02);opacity:.92}
      100%{transform:scale(1);opacity:1}
    }
    .mondayPulse{
      animation:pulseSoft 2.4s ease-in-out infinite;
      transform-origin:left center;
    }
  </style>
</head>

<body>
  <header>
    <h1 id="appTitle">Power Up <span class="titleEmoji">üèãÔ∏è‚Äç‚ôÄÔ∏èüíß</span></h1>
    <div class="sub">Steady Progress.</div>
    <div class="dateLine" id="dateLine"></div>

    <div class="tabbar" role="tablist">
      <div class="tab active" data-tab="workout">Workout</div>
      <div class="tab" data-tab="progress">Progress</div>
      <div class="tab" data-tab="week">Week Summary</div>
      <div class="tab" data-tab="reset">Health Reset</div>
      <div class="tab" data-tab="measurements">Measurements</div>
    </div>
  </header>

  <main class="wrap">
    <!-- WORKOUT -->
    <section id="tab-workout">
      <div class="card">
        <div class="topRow">
          <div>
            <h2 id="dayTitle">Monday workout</h2>
            <div class="hint">Tap a day, check off sets, and jot quick notes.</div>
          </div>

          <div class="rightTools">
            <button class="btn" id="editPlanBtn" type="button">Edit plan</button>
            <div class="allDone" id="allDonePill">All done ‚úì</div>
          </div>
        </div>

        <div class="days" id="dayChips"></div>
        <div id="exerciseList"></div>

        <div class="resetLink" id="resetTodayLink">Reset this day‚Äôs progress (today only).</div>
      </div>

      <div class="footerNote">All data is stored locally on this device.</div>
    </section>

    <!-- PROGRESS -->
    <section id="tab-progress" style="display:none;">
      <div class="card">
        <h2>Progress</h2>
        <div class="hint">Today‚Äôs completion + week-to-date.</div>

        <div class="statGrid">
          <div class="stat">
            <div class="k">Today</div>
            <div class="v" id="statToday">0%</div>
          </div>
          <div class="stat">
            <div class="k">Completed exercises (today)</div>
            <div class="v" id="statTodayCount">0 / 0</div>
          </div>
          <div class="stat">
            <div class="k">Days completed this week</div>
            <div class="v" id="statWeekDays">0</div>
          </div>
        </div>
      </div>

      <div class="footerNote">Built by consistency.</div>
    </section>

    <!-- WEEK SUMMARY -->
    <section id="tab-week" style="display:none;">
      <div class="card">
        <h2>Week Summary</h2>
        <div class="hint">A quick overview of each day.</div>
        <div id="weekSummary"></div>
      </div>

      <div class="footerNote">Built by consistency.</div>
    </section>

    <!-- HEALTH RESET -->
    <section id="tab-reset" style="display:none;">
      <div class="card">
        <div class="topRow">
          <div>
            <h2>Health Reset</h2>
            <div class="hint">Daily checklist (resets each day).</div>
          </div>
          <div class="rightTools">
            <button class="btn" id="editResetBtn" type="button">Edit reset</button>
          </div>
        </div>

        <div style="margin-top:10px;">
          <h3 class="subhead">Morning Thyroid Routine</h3>
          <div id="resetMorning"></div>
        </div>

        <div style="margin-top:14px;">
          <h3 class="subhead">Supplements Schedule</h3>
          <div id="resetSupps"></div>
        </div>

        <div style="margin-top:14px;">
          <h3 class="subhead">2-Week Thyroid-Friendly Reset</h3>
          <div id="resetRules"></div>
        </div>
      </div>

      <div class="footerNote">These checkmarks reset daily by date.</div>
    </section>

    <!-- MEASUREMENTS -->
    <section id="tab-measurements" style="display:none;">
      <div class="card">
        <h2>Measurements (Weekly)</h2>
        <div class="hint">Track trends, not perfection.</div>

        <div class="measGrid">
          <div><label>Weight</label><input id="m_weight" type="text" placeholder="e.g., 160" /></div>
          <div><label>Waist</label><input id="m_waist" type="text" placeholder="inches" /></div>
          <div><label>Hips</label><input id="m_hips" type="text" placeholder="inches" /></div>
          <div><label>Chest</label><input id="m_chest" type="text" placeholder="inches" /></div>
          <div><label>Thigh</label><input id="m_thigh" type="text" placeholder="inches" /></div>
          <div><label>Arm</label><input id="m_arm" type="text" placeholder="inches" /></div>
        </div>

        <div class="rowBtns">
          <button class="btn primary" id="measSaveBtn" type="button">Save this week</button>
          <button class="btn danger" id="measClearBtn" type="button">Clear this week</button>
        </div>

        <div id="measHistory" style="margin-top:14px;"></div>
      </div>

      <div class="footerNote">Built by consistency.</div>
    </section>
  </main>

  <!-- EDIT PLAN MODAL -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div>
          <h3 id="modalTitle">Edit plan</h3>
          <p id="modalSub">Edit exercises for the selected day. Saved changes show immediately.</p>
        </div>
        <div class="rowBtns" style="justify-content:flex-start;">
          <button class="btn" id="addExerciseBtn" type="button">+ Add exercise</button>
          <button class="btn danger" id="restoreDefaultsBtn" type="button">Restore defaults</button>
          <button class="btn" id="closeModalBtn" type="button">Close</button>
        </div>
      </div>

      <div id="editorBody" style="margin-top:10px;"></div>

      <div class="rowBtns">
        <button class="btn" id="cancelEditBtn" type="button">Cancel</button>
        <button class="btn primary" id="saveEditBtn" type="button">Save changes</button>
      </div>
    </div>
  </div>

  <!-- POPUP MODAL (circuits/mobility) -->
  <div class="modalBack" id="infoBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div>
          <h3 id="infoTitle">Details</h3>
          <p id="infoSub">Quick guide</p>
        </div>
        <div class="rowBtns" style="justify-content:flex-start;">
          <button class="btn" id="infoCloseBtn" type="button">Close</button>
        </div>
      </div>
      <div id="infoBody" class="infoBody"></div>
    </div>
  </div>

  <!-- EDIT RESET MODAL -->
  <div class="modalBack" id="resetBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div>
          <h3>Edit Health Reset</h3>
          <p>One item per line. Format: <b>Title | Subtitle</b></p>
        </div>
        <div class="rowBtns" style="justify-content:flex-start;">
          <button class="btn" id="resetCloseBtn" type="button">Close</button>
        </div>
      </div>

      <div class="editRow">
        <div style="font-weight:950;">Morning Thyroid Routine</div>
        <textarea id="resetMorningText" placeholder="Title | Subtitle&#10;Title | Subtitle"></textarea>
      </div>

      <div class="editRow">
        <div style="font-weight:950;">Supplements Schedule</div>
        <textarea id="resetSuppsText" placeholder="Title | Subtitle&#10;Title | Subtitle"></textarea>
      </div>

      <div class="editRow">
        <div style="font-weight:950;">2-Week Thyroid-Friendly Reset</div>
        <textarea id="resetRulesText" placeholder="Title | Subtitle&#10;Title | Subtitle"></textarea>
      </div>

      <div class="rowBtns">
        <button class="btn danger" id="resetRestoreBtn" type="button">Restore defaults</button>
        <button class="btn primary" id="resetSaveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   Defaults
========================= */
const DEFAULT_PLAN = {
  Monday: [
    { name: "Incline Dumbbell Press", sets: 3, reps: "10‚Äì12" },
    { name: "Lat Pulldown", sets: 3, reps: "10‚Äì12" },
    { name: "Dumbbell Shoulder Press", sets: 3, reps: "10‚Äì12" },
    { name: "Triceps Rope Pushdown", sets: 3, reps: "12‚Äì15" },
    { name: "Walking Treadmill", sets: 1, reps: "20‚Äì30 min" }
  ],
  Tuesday: [
    { name: "Goblet Squat", sets: 3, reps: "10‚Äì12" },
    { name: "Romanian Deadlift", sets: 3, reps: "10‚Äì12" },
    { name: "Glute Bridge/Hip Thrust", sets: 3, reps: "12‚Äì15" },
    { name: "Calf Raises", sets: 3, reps: "15‚Äì20" },
    { name: "Walking Treadmill", sets: 1, reps: "20‚Äì30 min" }
  ],
  Wednesday: [
    { name: "Push-Ups / Incline Push-Ups", sets: 3, reps: "As many as possible" },
    { name: "Dumbbell Row", sets: 3, reps: "10‚Äì12" },
    { name: "Lateral Raises", sets: 3, reps: "12‚Äì15" },
    { name: "Biceps Curls", sets: 3, reps: "10‚Äì12" },
    { name: "Core Circuit", sets: 3, reps: "3‚Äì4 exercises" }
  ],
  Thursday: [
    { name: "Leg Press or Step-Ups", sets: 3, reps: "10‚Äì12" },
    { name: "Lunges (or split squats)", sets: 3, reps: "10‚Äì12/leg" },
    { name: "Hamstring Curl", sets: 3, reps: "10‚Äì12" },
    { name: "Core Circuit", sets: 3, reps: "3‚Äì4 exercises" },
    { name: "Walking Treadmill", sets: 1, reps: "20‚Äì30 min" }
  ],
  Friday: [
    { name: "Full-Body Circuit", sets: 3, reps: "8‚Äì10 exercises" },
    { name: "Extra Arms / Glutes", sets: 2, reps: "Choose your favs" },
    { name: "Stretching / Mobility", sets: 1, reps: "10‚Äì15 min" },
    { name: "Walking Treadmill", sets: 1, reps: "20‚Äì30 min" }
  ],
  Saturday: [
    { name: "Optional: Light Walk", sets: 1, reps: "20‚Äì40 min" },
    { name: "Stretching / Yoga", sets: 1, reps: "10‚Äì20 min" }
  ],
  Sunday: [
    { name: "Rest / Mobility", sets: 1, reps: "10‚Äì20 min" }
  ]
};

const INFO_TEXT = {
  core: `Pick 3‚Äì4 moves below. Do them in a loop.
Rest 30‚Äì45 seconds between moves.
Rest 60‚Äì90 seconds between rounds.
Total time: 10‚Äì15 minutes

Option A (best overall)

Dead Bug ‚Äì 8‚Äì10/side
Bird Dog ‚Äì 8‚Äì10/side
Side Plank ‚Äì 20‚Äì30 sec/side
Glute Bridge ‚Äì 12‚Äì15

Option B (more ‚Äútight waist‚Äù feel)

Pallof Press (band/cable) ‚Äì 10‚Äì12/side
Plank ‚Äì 30‚Äì45 sec
Suitcase Carry (one dumbbell) ‚Äì 30‚Äì45 sec/side
Reverse Crunch ‚Äì 10‚Äì12 (slow)

üëâ Rule: if anything hurts your low back, swap it.`,
  full: `‚úÖ Full-Body Circuit (3 sets ‚Ä¢ 8‚Äì10 exercises)

This is a moderate pace circuit, not HIIT.
Pick 8 exercises (or use my ready-made one below).
Work 35‚Äì45 sec, rest 15‚Äì25 sec between exercises.
Rest 90 sec between rounds.
Total time: 20‚Äì30 minutes

Ready-made Full-Body Circuit (my favorite for fat loss + strength)

Goblet Squat
Dumbbell Row
Incline Dumbbell Press (or push-ups)
Romanian Deadlift (light‚Äìmoderate)
Shoulder Press
Lateral Raise
Glute Bridge / Hip Thrust
Pallof Press or Dead Bug

Optional 9‚Äì10:
Biceps Curl
Triceps Rope Pushdown

üëâ Keep weights where you can maintain good form. The goal is ‚Äúsweaty but controlled.‚Äù`,
  stretch: `‚úÖ Stretching / Mobility (10‚Äì15 min)

This is your ‚Äúfeel better tomorrow‚Äù block.

Quick 10‚Äì12 minute mobility flow

Chest opener stretch (doorway) ‚Äì 45 sec
Child‚Äôs pose ‚Äì 45 sec
Hip flexor stretch ‚Äì 45 sec/side
Figure-4 glute stretch ‚Äì 45 sec/side
Hamstring stretch ‚Äì 45 sec/side
Thoracic rotation (‚Äúopen books‚Äù) ‚Äì 8 reps/side
Calf stretch ‚Äì 30‚Äì45 sec/side

If knees are cranky: do hip + upper body stretches more, less deep knee bending.`
};

/* Exercise library for picker */
const EXERCISE_LIBRARY = {
  "Chest": [
    { name:"Incline Dumbbell Press", reps:"10‚Äì12" },
    { name:"Push-Ups", reps:"AMRAP" }
  ],
  "Back": [
    { name:"Lat Pulldown", reps:"10‚Äì12" },
    { name:"Dumbbell Row", reps:"10‚Äì12" }
  ],
  "Shoulders": [
    { name:"Dumbbell Shoulder Press", reps:"10‚Äì12" },
    { name:"Lateral Raises", reps:"12‚Äì15" }
  ],
  "Biceps": [
    { name:"Biceps Curls", reps:"10‚Äì12" },
    { name:"Hammer Curls", reps:"10‚Äì12" }
  ],
  "Triceps": [
    { name:"Triceps Rope Pushdown", reps:"12‚Äì15" },
    { name:"Overhead Triceps Extension", reps:"10‚Äì12" }
  ],
  "Legs/Glutes": [
    { name:"Goblet Squat", reps:"10‚Äì12" },
    { name:"Romanian Deadlift", reps:"10‚Äì12" },
    { name:"Glute Bridge/Hip Thrust", reps:"12‚Äì15" },
    { name:"Lunges (or split squats)", reps:"10‚Äì12/leg" },
    { name:"Leg Press or Step-Ups", reps:"10‚Äì12" },
    { name:"Hamstring Curl", reps:"10‚Äì12" },
    { name:"Calf Raises", reps:"15‚Äì20" }
  ],
  "Core": [
    { name:"Core Circuit", reps:"3‚Äì4 exercises" },
    { name:"Pallof Press", reps:"10‚Äì12/side" },
    { name:"Dead Bug", reps:"8‚Äì10/side" }
  ],
  "Conditioning": [
    { name:"Walking Treadmill", reps:"20‚Äì30 min" },
    { name:"Optional: Light Walk", reps:"20‚Äì40 min" }
  ],
  "Mobility": [
    { name:"Stretching / Mobility", reps:"10‚Äì15 min" },
    { name:"Stretching / Yoga", reps:"10‚Äì20 min" },
    { name:"Rest / Mobility", reps:"10‚Äì20 min" }
  ],
  "Circuits": [
    { name:"Full-Body Circuit", reps:"8‚Äì10 exercises" },
    { name:"Extra Arms / Glutes", reps:"Choose your favs" }
  ]
};

/* Health reset defaults */
const RESET_DEFAULTS = {
  morning: [
    { key:"synthroid", title:"6:30 AM: Synthroid (empty stomach)", sub:"Water is fine. Avoid supplements/minerals/fiber for 45‚Äì60 minutes." },
    { key:"lemon", title:"Warm lemon water at work is OK", sub:"No minerals in lemon = fine with Synthroid timing." },
    { key:"coffee", title:"Coffee + collagen after your wait window", sub:"Aim for 45‚Äì60 minutes after Synthroid." },
    { key:"salt", title:"Finish Baja Gold salt water after coffee", sub:"Small sips earlier are fine; finishing later is the cleanest." }
  ],
  supps: [
    { key:"lunch_probiotic", title:"Lunch: Probiotic", sub:"Keep consistent." },
    { key:"dinner_multi", title:"Dinner: Multi (with minerals)", sub:"Keeps minerals away from Synthroid." },
    { key:"dinner_chromium", title:"Dinner: Chromium (if using)", sub:"Best with higher-carb meal." },
    { key:"bed_mag", title:"Bedtime: Magnesium", sub:"Supports sleep + insulin sensitivity." }
  ],
  rules: [
    { key:"protein", title:"Protein first at every meal", sub:"Stabilizes appetite + blood sugar." },
    { key:"carb_once", title:"Carbs once per day", sub:"Pick the meal you want them most." },
    { key:"walk", title:"Walk 10‚Äì15 minutes after carb meals", sub:"Big impact for glucose control." },
    { key:"no_hiit", title:"No punishment HIIT", sub:"Keep cortisol lower for better fat loss." }
  ]
};

/* =========================
   Storage keys
========================= */
const LS = {
  workoutProgress: "pu_progress_v2",
  resetChecks: "pu_resetChecks_v2",
  planOverride: "pu_planOverride_v2",
  measurements: "pu_measurements_v2",
  resetOverride: "pu_resetOverride_v2"
};

/* =========================
   Helpers
========================= */
const DAYS = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];

function pad(n){ return String(n).padStart(2,"0"); }
function isoDate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
function prettyDate(d){
  return d.toLocaleDateString(undefined, { weekday:"long", month:"short", day:"numeric", year:"numeric" });
}
function currentDayName(){
  return new Date().toLocaleDateString(undefined, { weekday:"long" });
}
function load(key, fallback){
  try{
    const v = JSON.parse(localStorage.getItem(key));
    return (v === null || v === undefined) ? fallback : v;
  }catch{
    return fallback;
  }
}
function save(key, val){
  localStorage.setItem(key, JSON.stringify(val));
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function escapeAttr(str){
  return escapeHtml(str).replaceAll("\n"," ");
}

/* ISO week (for weekly measurements) */
function getISOWeekKey(date=new Date()){
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
  return `${d.getUTCFullYear()}-W${String(weekNo).padStart(2,"0")}`;
}

/* =========================
   Plan source
========================= */
function getPlan(){
  const override = load(LS.planOverride, null);
  if(override && typeof override === "object") return override;
  return DEFAULT_PLAN;
}
function setPlan(plan){
  save(LS.planOverride, plan);
}

/* =========================
   App state
========================= */
const today = new Date();
const todayISO = isoDate(today);
let selectedDay = DAYS.includes(currentDayName()) ? currentDayName() : "Monday";

/* Monday pulse */
if(new Date().getDay() === 1){
  document.getElementById("appTitle").classList.add("mondayPulse");
}

/* =========================
   Tabs
========================= */
const tabEls = Array.from(document.querySelectorAll(".tab"));
const sections = {
  workout: document.getElementById("tab-workout"),
  progress: document.getElementById("tab-progress"),
  week: document.getElementById("tab-week"),
  reset: document.getElementById("tab-reset"),
  measurements: document.getElementById("tab-measurements")
};

tabEls.forEach(t => t.addEventListener("click", () => setTab(t.dataset.tab)));

function setTab(name){
  tabEls.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
  Object.keys(sections).forEach(k => {
    sections[k].style.display = (k === name) ? "" : "none";
  });

  if(name === "workout") renderWorkout();
  if(name === "progress") renderProgress();
  if(name === "week") renderWeekSummary();
  if(name === "reset") renderReset();
  if(name === "measurements") renderMeasurements();
}

/* =========================
   Workout progress storage
========================= */
function getProgress(){ return load(LS.workoutProgress, {}); }
function setExerciseField(day, idx, field, value){
  const p = getProgress();
  p[day] = p[day] || {};
  p[day][idx] = p[day][idx] || { done:false, weight:"", notes:"" };
  p[day][idx][field] = value;
  save(LS.workoutProgress, p);
}
function getExerciseState(day, idx){
  const p = getProgress();
  return (p[day] && p[day][idx]) ? p[day][idx] : { done:false, weight:"", notes:"" };
}
function resetDayProgress(day){
  const p = getProgress();
  delete p[day];
  save(LS.workoutProgress, p);
}

/* =========================
   Workout rendering
========================= */
const dayTitle = document.getElementById("dayTitle");
const allDonePill = document.getElementById("allDonePill");
const dayChips = document.getElementById("dayChips");
const exerciseList = document.getElementById("exerciseList");
const resetTodayLink = document.getElementById("resetTodayLink");

function renderDayChips(){
  dayChips.innerHTML = "";
  DAYS.forEach(d => {
    const c = document.createElement("div");
    c.className = "chip" + (d === selectedDay ? " active" : "");
    c.textContent = d.slice(0,3);
    c.title = d;
    c.addEventListener("click", () => {
      selectedDay = d;
      renderWorkout();
    });
    dayChips.appendChild(c);
  });
}

/* Clickable names that open info popup */
function isInfoExercise(name){
  const n = String(name || "").toLowerCase();
  return (
    n.includes("core circuit") ||
    n.includes("full-body circuit") ||
    n.includes("stretching / mobility") ||
    n.includes("stretching / yoga") ||
    n.includes("rest / mobility")
  );
}
function openInfoForExercise(name){
  const n = String(name || "").toLowerCase();
  let title = "Details";
  let body = "No details found.";
  if(n.includes("core circuit")){ title = "Core Circuit"; body = INFO_TEXT.core; }
  else if(n.includes("full-body circuit")){ title = "Full-Body Circuit"; body = INFO_TEXT.full; }
  else if(n.includes("stretching / mobility") || n.includes("stretching / yoga") || n.includes("rest / mobility")){
    title = "Stretching / Mobility";
    body = INFO_TEXT.stretch;
  }
  document.getElementById("infoTitle").textContent = title;
  document.getElementById("infoSub").textContent = "Tap Close when done.";
  document.getElementById("infoBody").textContent = body;
  document.getElementById("infoBack").style.display = "flex";
}

function renderWorkout(){
  renderDayChips();
  dayTitle.textContent = `${selectedDay} workout`;

  const plan = getPlan();
  const exercises = plan[selectedDay] || [];
  exerciseList.innerHTML = "";

  let doneCount = 0;

  exercises.forEach((ex, idx) => {
    const st = getExerciseState(selectedDay, idx);
    if(st.done) doneCount++;

    const wrap = document.createElement("div");
    wrap.className = "ex";

    const clickable = isInfoExercise(ex.name);
    const nameHtml = clickable
      ? `<button type="button" class="btn" style="padding:0;border:none;background:transparent;text-align:left;font-weight:950;font-size:18px;cursor:pointer;color:var(--text);" data-info="1">${escapeHtml(ex.name)}</button>`
      : `<p class="exName">${escapeHtml(ex.name)}</p>`;

    wrap.innerHTML = `
      <div class="exHead">
        <div>
          ${nameHtml}
          <div class="exMeta">${ex.sets} sets ‚Ä¢ ${escapeHtml(ex.reps)}</div>
        </div>

        <button class="doneBtn ${st.done ? "checked" : ""}" type="button">
          <span class="doneBox">${st.done ? "‚úì" : ""}</span>
          Done
        </button>
      </div>

      <div class="grid2">
        <div>
          <label>Weight / Level</label>
          <input type="text" placeholder="e.g. 15 lb DBs" value="${escapeAttr(st.weight || "")}" />
        </div>
        <div>
          <label>Notes</label>
          <textarea placeholder="How it felt, tweaks, etc.">${escapeHtml(st.notes || "")}</textarea>
        </div>
      </div>
    `;

    const doneBtn = wrap.querySelector(".doneBtn");
    const weightInput = wrap.querySelector("input");
    const notesArea = wrap.querySelector("textarea");

    doneBtn.addEventListener("click", () => {
      const cur = getExerciseState(selectedDay, idx);
      setExerciseField(selectedDay, idx, "done", !cur.done);
      renderWorkout();
      renderProgress();
      renderWeekSummary();
    });

    weightInput.addEventListener("input", (e) => setExerciseField(selectedDay, idx, "weight", e.target.value));
    notesArea.addEventListener("input", (e) => setExerciseField(selectedDay, idx, "notes", e.target.value));

    const infoBtn = wrap.querySelector('[data-info="1"]');
    if(infoBtn){
      infoBtn.addEventListener("click", () => openInfoForExercise(ex.name));
    }

    exerciseList.appendChild(wrap);
  });

  const allDone = exercises.length > 0 && doneCount === exercises.length;
  allDonePill.style.display = allDone ? "inline-block" : "none";
}

resetTodayLink.addEventListener("click", () => {
  const todayName = currentDayName();
  if(selectedDay !== todayName){
    alert("This reset link is for today's day only. Tap today's day to reset it.");
    return;
  }
  if(confirm("Reset today's progress? This clears Done/Weight/Notes for today.")){
    resetDayProgress(selectedDay);
    renderWorkout();
    renderProgress();
    renderWeekSummary();
  }
});

/* =========================
   Progress + Week summary
========================= */
const statToday = document.getElementById("statToday");
const statTodayCount = document.getElementById("statTodayCount");
const statWeekDays = document.getElementById("statWeekDays");
const weekSummary = document.getElementById("weekSummary");

function dayCompletion(day){
  const plan = getPlan();
  const exercises = plan[day] || [];
  if(exercises.length === 0) return { done:0, total:0, pct:0 };
  let done = 0;
  exercises.forEach((_, idx) => { if(getExerciseState(day, idx).done) done++; });
  const pct = Math.round((done / exercises.length) * 100);
  return { done, total: exercises.length, pct };
}

function renderProgress(){
  const todayName = currentDayName();
  const c = dayCompletion(todayName);
  statToday.textContent = `${c.pct}%`;
  statTodayCount.textContent = `${c.done} / ${c.total}`;

  let completedDays = 0;
  DAYS.forEach(d => {
    const dc = dayCompletion(d);
    if(dc.total > 0 && dc.done === dc.total) completedDays++;
  });
  statWeekDays.textContent = String(completedDays);
}

function renderWeekSummary(){
  weekSummary.innerHTML = "";
  DAYS.forEach(d => {
    const c = dayCompletion(d);
    const row = document.createElement("div");
    row.className = "ex";
    row.style.padding = "10px 12px";
    row.innerHTML = `
      <div class="exHead">
        <div>
          <p class="exName" style="font-size:16px; margin:0;">${d}</p>
          <div class="exMeta">${c.done} / ${c.total} completed ‚Ä¢ ${c.pct}%</div>
        </div>
        <div class="allDone" style="display:${(c.total>0 && c.done===c.total) ? "inline-block" : "none"};">All done ‚úì</div>
      </div>
    `;
    weekSummary.appendChild(row);
  });
}

/* =========================
   Health Reset (daily checks)
========================= */
const resetMorningEl = document.getElementById("resetMorning");
const resetSuppsEl = document.getElementById("resetSupps");
const resetRulesEl = document.getElementById("resetRules");

function getResetChecks(){ return load(LS.resetChecks, {}); }
function getChecksForToday(){
  const all = getResetChecks();
  return all[todayISO] || {};
}
function setCheck(key, val){
  const all = getResetChecks();
  const day = all[todayISO] || {};
  day[key] = !!val;
  all[todayISO] = day;
  save(LS.resetChecks, all);
}

/* Reset list source (editable) */
function getResetLists(){
  const o = load(LS.resetOverride, null);
  if(o && typeof o === "object" && o.morning && o.supps && o.rules) return o;
  return RESET_DEFAULTS;
}
function setResetLists(obj){
  save(LS.resetOverride, obj);
}

function renderResetSection(container, items){
  container.innerHTML = "";
  const checks = getChecksForToday();

  items.forEach(it => {
    const row = document.createElement("div");
    row.className = "check";
    row.innerHTML = `
      <input type="checkbox" ${checks[it.key] ? "checked" : ""} />
      <div>
        <div class="t">${escapeHtml(it.title)}</div>
        <div class="s">${escapeHtml(it.sub)}</div>
      </div>
    `;
    row.querySelector("input").addEventListener("change", (e) => setCheck(it.key, e.target.checked));
    container.appendChild(row);
  });
}

function renderReset(){
  const lists = getResetLists();
  renderResetSection(resetMorningEl, lists.morning);
  renderResetSection(resetSuppsEl, lists.supps);
  renderResetSection(resetRulesEl, lists.rules);
}

/* Edit reset modal logic */
const editResetBtn = document.getElementById("editResetBtn");
const resetBack = document.getElementById("resetBack");
const resetCloseBtn = document.getElementById("resetCloseBtn");
const resetSaveBtn = document.getElementById("resetSaveBtn");
const resetRestoreBtn = document.getElementById("resetRestoreBtn");

function listsToText(list){
  return list.map(x => `${x.title} | ${x.sub}`).join("\n");
}
function textToList(text, prefix){
  const lines = String(text || "").split("\n").map(l => l.trim()).filter(Boolean);
  return lines.map((line, i) => {
    const parts = line.split("|");
    const title = (parts[0] || "").trim() || "Untitled";
    const sub = (parts.slice(1).join("|") || "").trim() || "";
    return { key:`${prefix}_${i+1}`, title, sub };
  });
}
function openResetEditor(){
  const lists = getResetLists();
  document.getElementById("resetMorningText").value = listsToText(lists.morning);
  document.getElementById("resetSuppsText").value = listsToText(lists.supps);
  document.getElementById("resetRulesText").value = listsToText(lists.rules);
  resetBack.style.display = "flex";
}
function closeResetEditor(){
  resetBack.style.display = "none";
}

editResetBtn.addEventListener("click", openResetEditor);
resetCloseBtn.addEventListener("click", closeResetEditor);
resetBack.addEventListener("click", (e) => { if(e.target === resetBack) closeResetEditor(); });

resetSaveBtn.addEventListener("click", () => {
  const morning = textToList(document.getElementById("resetMorningText").value, "m");
  const supps = textToList(document.getElementById("resetSuppsText").value, "s");
  const rules = textToList(document.getElementById("resetRulesText").value, "r");
  setResetLists({ morning, supps, rules });
  closeResetEditor();
  renderReset();
  alert("Reset updated!");
});

resetRestoreBtn.addEventListener("click", () => {
  if(!confirm("Restore the default Health Reset text?")) return;
  setResetLists(RESET_DEFAULTS);
  openResetEditor();
  renderReset();
});

/* =========================
   Measurements (weekly)
========================= */
const measFields = ["weight","waist","hips","chest","thigh","arm"];
function getMeas(){ return load(LS.measurements, {}); }
function setMeas(obj){ save(LS.measurements, obj); }

function renderMeasurements(){
  const wk = getISOWeekKey(new Date());
  const all = getMeas();
  const cur = all[wk] || {};

  measFields.forEach(f => {
    const el = document.getElementById("m_"+f);
    if(el) el.value = cur[f] || "";
  });

  const hist = document.getElementById("measHistory");
  hist.innerHTML = "";

  const keys = Object.keys(all).sort().reverse();
  if(keys.length === 0){
    hist.innerHTML = `<div class="historyRow" style="color:var(--muted);font-weight:650;">No history yet. Save your first week.</div>`;
    return;
  }

  keys.forEach(k => {
    const row = document.createElement("div");
    row.className = "historyRow";
    const v = all[k] || {};
    row.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
        <div style="font-weight:950;">${escapeHtml(k)}</div>
        <div style="color:var(--muted);font-weight:650;">Weight: ${escapeHtml(v.weight || "‚Äî")}</div>
      </div>
      <div style="margin-top:6px;color:var(--muted);font-weight:650;font-size:13px;">
        Waist: ${escapeHtml(v.waist || "‚Äî")} ‚Ä¢ Hips: ${escapeHtml(v.hips || "‚Äî")} ‚Ä¢ Chest: ${escapeHtml(v.chest || "‚Äî")} ‚Ä¢ Thigh: ${escapeHtml(v.thigh || "‚Äî")} ‚Ä¢ Arm: ${escapeHtml(v.arm || "‚Äî")}
      </div>
    `;
    hist.appendChild(row);
  });
}

document.getElementById("measSaveBtn").addEventListener("click", () => {
  const wk = getISOWeekKey(new Date());
  const all = getMeas();
  const cur = {};
  measFields.forEach(f => {
    cur[f] = (document.getElementById("m_"+f).value || "").trim();
  });
  all[wk] = cur;
  setMeas(all);
  renderMeasurements();
  alert("Saved!");
});

document.getElementById("measClearBtn").addEventListener("click", () => {
  if(!confirm("Clear this week's entries (does not delete history)?")) return;
  measFields.forEach(f => { document.getElementById("m_"+f).value = ""; });
});

/* =========================
   Edit Plan modal + picker
========================= */
const editPlanBtn = document.getElementById("editPlanBtn");
const modalBack = document.getElementById("modalBack");
const editorBody = document.getElementById("editorBody");
const closeModalBtn = document.getElementById("closeModalBtn");
const cancelEditBtn = document.getElementById("cancelEditBtn");
const saveEditBtn = document.getElementById("saveEditBtn");
const addExerciseBtn = document.getElementById("addExerciseBtn");
const restoreDefaultsBtn = document.getElementById("restoreDefaultsBtn");

let draftPlan = null;

function openEditor(){
  draftPlan = structuredClone(getPlan());
  if(!draftPlan[selectedDay]) draftPlan[selectedDay] = [];
  renderEditorRows();
  modalBack.style.display = "flex";
}
function closeEditor(){
  modalBack.style.display = "none";
  draftPlan = null;
}

function buildLibrarySelect(){
  const sel = document.createElement("select");
  sel.innerHTML = `<option value="">Pick from library‚Ä¶</option>`;
  Object.keys(EXERCISE_LIBRARY).forEach(cat => {
    const og = document.createElement("optgroup");
    og.label = cat;
    EXERCISE_LIBRARY[cat].forEach(item => {
      const opt = document.createElement("option");
      opt.value = JSON.stringify(item);
      opt.textContent = item.name;
      og.appendChild(opt);
    });
    sel.appendChild(og);
  });
  return sel;
}

function renderEditorRows(){
  editorBody.innerHTML = "";
  const list = (draftPlan && draftPlan[selectedDay]) ? draftPlan[selectedDay] : [];

  if(list.length === 0){
    const empty = document.createElement("div");
    empty.className = "editRow";
    empty.innerHTML = `<div style="font-weight:950;">No exercises yet.</div><div style="color:var(--muted);font-weight:650;margin-top:4px;">Click ‚ÄúAdd exercise‚Äù to create one.</div>`;
    editorBody.appendChild(empty);
    return;
  }

  list.forEach((ex, idx) => {
    const row = document.createElement("div");
    row.className = "editRow";

    row.innerHTML = `
      <div style="display:flex; justify-content:space-between; gap:10px; align-items:center; flex-wrap:wrap;">
        <div style="font-weight:950;">Exercise ${idx+1}</div>
        <button class="btn danger" type="button">Delete</button>
      </div>

      <div style="margin-top:10px;">
        <label>Quick pick</label>
        <div class="pickSlot"></div>
      </div>

      <div class="editGrid">
        <div>
          <label>Name</label>
          <input type="text" value="${escapeAttr(ex.name || "")}" />
        </div>
        <div>
          <label>Sets</label>
          <input type="number" min="1" step="1" value="${escapeAttr(ex.sets ?? 3)}" />
        </div>
        <div>
          <label>Reps</label>
          <input type="text" value="${escapeAttr(ex.reps || "")}" />
        </div>
      </div>
    `;

    const delBtn = row.querySelector("button");
    const [nameInput, setsInput, repsInput] = row.querySelectorAll(".editGrid input");

    /* Picker */
    const pickSlot = row.querySelector(".pickSlot");
    const picker = buildLibrarySelect();
    pickSlot.appendChild(picker);

    picker.addEventListener("change", () => {
      if(!picker.value) return;
      try{
        const item = JSON.parse(picker.value);
        draftPlan[selectedDay][idx].name = item.name;
        if(!draftPlan[selectedDay][idx].reps || draftPlan[selectedDay][idx].reps === "‚Äî"){
          draftPlan[selectedDay][idx].reps = item.reps || draftPlan[selectedDay][idx].reps;
        }else{
          draftPlan[selectedDay][idx].reps = item.reps || draftPlan[selectedDay][idx].reps;
        }
        nameInput.value = item.name;
        repsInput.value = item.reps || repsInput.value;
      }catch{}
      picker.value = "";
    });

    nameInput.addEventListener("input", (e) => { draftPlan[selectedDay][idx].name = e.target.value; });
    setsInput.addEventListener("input", (e) => {
      const v = parseInt(e.target.value, 10);
      draftPlan[selectedDay][idx].sets = Number.isFinite(v) && v > 0 ? v : 1;
    });
    repsInput.addEventListener("input", (e) => { draftPlan[selectedDay][idx].reps = e.target.value; });

    delBtn.addEventListener("click", () => {
      if(!confirm("Delete this exercise?")) return;
      draftPlan[selectedDay].splice(idx, 1);
      renderEditorRows();
    });

    editorBody.appendChild(row);
  });
}

editPlanBtn.addEventListener("click", openEditor);
closeModalBtn.addEventListener("click", closeEditor);
cancelEditBtn.addEventListener("click", closeEditor);
modalBack.addEventListener("click", (e) => { if(e.target === modalBack) closeEditor(); });

addExerciseBtn.addEventListener("click", () => {
  if(!draftPlan[selectedDay]) draftPlan[selectedDay] = [];
  draftPlan[selectedDay].push({ name:"New Exercise", sets:3, reps:"10‚Äì12" });
  renderEditorRows();
});

restoreDefaultsBtn.addEventListener("click", () => {
  if(!confirm("Restore your original default plan for ALL days? (This does not erase your workout notes.)")) return;
  setPlan(structuredClone(DEFAULT_PLAN));
  closeEditor();
  renderWorkout();
  renderProgress();
  renderWeekSummary();
  alert("Defaults restored.");
});

saveEditBtn.addEventListener("click", () => {
  const list = draftPlan[selectedDay] || [];
  for(const ex of list){
    ex.name = String(ex.name || "").trim() || "Unnamed Exercise";
    ex.reps = String(ex.reps || "").trim() || "‚Äî";
    const s = parseInt(ex.sets, 10);
    ex.sets = Number.isFinite(s) && s > 0 ? s : 1;
  }
  setPlan(draftPlan);
  closeEditor();
  renderWorkout();
  renderProgress();
  renderWeekSummary();
  alert("Plan saved!");
});

/* =========================
   Info modal close
========================= */
document.getElementById("infoCloseBtn").addEventListener("click", () => {
  document.getElementById("infoBack").style.display = "none";
});
document.getElementById("infoBack").addEventListener("click", (e) => {
  if(e.target === document.getElementById("infoBack")){
    document.getElementById("infoBack").style.display = "none";
  }
});

/* =========================
   Boot
========================= */
document.getElementById("dateLine").textContent = prettyDate(today);
renderWorkout();
renderProgress();
renderWeekSummary();
renderReset();
renderMeasurements();
setTab("workout");
</script>
</body>
</html>
