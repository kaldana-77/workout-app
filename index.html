<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ever Strong üíßüí™üèº</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f7f7;
      --card: #ffffff;
      --accent: #2c7be5;
      --accent-soft: #e1edff;
      --text: #222222;
      --muted: #777777;
      --border: #dddddd;
      --danger: #e55353;
      --success: #28a745;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 10px;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding-bottom: 70px; /* space for bottom tabs */
    }

    header {
      text-align: center;
      margin-bottom: 12px;
    }

    header h1 {
      font-size: 1.4rem;
      margin: 0 0 4px 0;
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .date-label {
      margin-top: 4px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .day-tabs {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 6px;
      margin: 10px 0 8px 0;
      padding-bottom: 4px;
    }

    .day-tab {
      border-radius: 99px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 0.85rem;
      background: #fff;
      white-space: nowrap;
      cursor: pointer;
      flex: 0 0 auto;
    }

    .day-tab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      font-weight: 600;
    }

    .card {
      background: var(--card);
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 12px;
    }

    .workout-summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 4px;
      gap: 8px;
    }

    .workout-summary .left {
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid var(--border);
      background:#fff;
      white-space: nowrap;
    }

    .badge-complete {
      color: var(--success);
      border-color: var(--success);
    }

    .badge-incomplete {
      color: var(--danger);
      border-color: var(--danger);
    }

    .tiny-btn {
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 0.75rem;
      cursor: pointer;
      color: var(--text);
    }
    .tiny-btn:hover {
      background: var(--accent-soft);
      border-color: var(--accent);
    }

    .exercise {
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 8px;
      margin-bottom: 8px;
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .exercise-name {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .exercise-info {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .exercise-controls {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      flex-wrap: wrap;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      flex: 1 1 100px;
    }

    .form-group label {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      font-size: 0.8rem;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid var(--border);
      width: 100%;
      background:#fff;
      color: var(--text);
    }

    .form-group textarea {
      min-height: 40px;
      resize: vertical;
    }

    .done-toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
    }

    .done-toggle input {
      width: 18px;
      height: 18px;
    }

    .footer-note {
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 8px;
    }

    .reset-btn {
      margin-top: 4px;
      font-size: 0.75rem;
      background: none;
      border: none;
      color: var(--danger);
      text-decoration: underline;
      cursor: pointer;
      padding: 0;
    }

    /* Underline explanation link */
    .circuit-link {
      font-size: 0.75rem;
      color: var(--accent);
      text-decoration: underline;
      cursor: pointer;
      width: fit-content;
      margin-top: 2px;
    }
    .circuit-help {
      display:none;
      font-size: 0.75rem;
      color: var(--muted);
      border-top: 1px dashed var(--border);
      padding-top: 6px;
      margin-top: 6px;
    }

    /* Scrollbar styling for day tabs */
    .day-tabs::-webkit-scrollbar { height: 4px; }
    .day-tabs::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 999px;
    }

    /* Bottom App Tabs */
    .app-tabs {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(247,247,247,0.98);
      border-top: 1px solid var(--border);
      padding: 8px 10px 10px;
    }
    .app-tabs-inner {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .app-tab {
      border-radius: 99px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 0.85rem;
      background: #fff;
      white-space: nowrap;
      cursor: pointer;
      flex: 0 0 auto;
    }
    .app-tab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      font-weight: 600;
    }

    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 12px;
      z-index: 1000;
    }
    .modal {
      width: 100%;
      max-width: 680px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    .modal-header {
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }
    .modal-header strong { font-size: 0.9rem; }
    .modal-body {
      padding: 10px;
      max-height: 70vh;
      overflow: auto;
    }
    .modal-footer {
      padding: 10px;
      border-top: 1px solid var(--border);
      display:flex;
      justify-content: flex-end;
      gap: 8px;
      background: #fff;
    }
    .row {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
      background: #fff;
    }
    .row-top {
      display:flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items:flex-end;
    }
    .row-actions {
      margin-top: 6px;
      display:flex;
      justify-content: flex-end;
    }
   
    #resetItemsText {
    min-height: 280px;
    }  

    .hidden { display:none; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <h1>Ever Strong üíßüí™üèº</h1>
      <p>Strength for Today, Health for Tomorrow.</p>
      <div class="date-label" id="currentDateLabel"></div>
    </header>

    <div class="day-tabs" id="dayTabs"></div>

    <!-- WORKOUT TAB -->
    <div id="tab-workout">
      <div class="card">
        <div class="workout-summary">
          <div class="left">
            <span id="currentDayLabel"></span>
            <button class="tiny-btn" id="editPlanBtn" type="button">Edit plan</button>
          </div>
          <span class="badge" id="completionBadge"></span>
        </div>
        <div id="exerciseList"></div>
        <button class="reset-btn" id="resetDayBtn" type="button">
          Reset this day‚Äôs progress
        </button>
      </div>

      <div class="footer-note">
        Ever Strong: Define your Strong.
      </div>
    </div>

    <!-- PROGRESS TAB -->
    <div id="tab-progress" class="hidden">
      <div class="card">
        <div class="workout-summary">
          <span>Progress</span>
          <span class="badge" id="progressBadge">‚Äî</span>
        </div>
        <div class="exercise" style="gap:6px;">
          <div class="exercise-name" style="font-size:0.9rem;">This week</div>
          <div class="exercise-info" id="weekSummary">‚Äî</div>
        </div>
        <div class="progress-wrap" aria-label="Weekly progress">
          <div class="progress-bar" id="weekProgressBar"></div>
        </div>
        <div class="progress-meta">
          <span id="weekProgressText">‚Äî</span>
          <span id="weekProgressPct">0%</span>
        </div>    

        <div class="progress-wrap" aria-label="Weekly progress">
          <div class="progress-bar" id="weekProgressBar"></div>
        </div>
        <div class="progress-meta">
           <span id="weekProgressText">‚Äî</span>
           <span id="weekProgressPct">0%</span>
        </div>
        <div class="exercise" style="gap:6px;">
          <div class="exercise-name" style="font-size:0.9rem;">Streak</div>
          <div class="exercise-info" id="streakSummary">‚Äî</div>
        </div>
      </div>

      <div class="footer-note">
        Ever Strong: Define your Strong.
      </div>
    </div>

    <!-- MEASUREMENTS TAB -->
    <div id="tab-measurements" class="hidden">
      <div class="card">
        <div class="workout-summary">
          <span>Measurements</span>
          <span class="badge" id="measBadge">Saved</span>
        </div>

        <div class="exercise-controls">
          <div class="form-group" style="flex:1 1 140px;">
            <label>Date</label>
            <input type="date" id="mDate">
          </div>
          <div class="form-group">
            <label>Weight</label>
            <input type="text" id="mWeight" placeholder="e.g. 160">
          </div>
          <div class="form-group">
            <label>Waist</label>
            <input type="text" id="mWaist" placeholder="in">
          </div>
          <div class="form-group">
            <label>Hips</label>
            <input type="text" id="mHips" placeholder="in">
          </div>
          <div class="form-group">
            <label>Chest</label>
            <input type="text" id="mChest" placeholder="in">
          </div>
          <div class="form-group" style="flex:1 1 220px;">
            <label>Notes</label>
            <input type="text" id="mNotes" placeholder="how you felt">
          </div>
        </div>

        <div style="display:flex; gap:8px; margin-top:8px; justify-content:flex-end;">
          <button class="tiny-btn" id="viewMeasurementsBtn" type="button">View saved</button>
          <button class="tiny-btn" id="saveMeasurementBtn" type="button">Save</button>
        </div>

        <div id="measurementsList" class="row hidden" style="margin-top:10px;"></div>
      </div>

      <div class="footer-note">
        Ever Strong: Define your Strong.
      </div>
    </div>

    <!-- HEALTH RESET TAB -->
    <div id="tab-reset" class="hidden">
      <div class="card">
        <div class="workout-summary">
          <div class="left">
            <span>Health Reset</span>
            <button class="tiny-btn" id="editResetBtn" type="button">Edit</button>
          </div>
          <span class="badge" id="resetBadge">‚Äî</span>
        </div>

        <div id="resetList"></div>

        <button class="reset-btn" id="resetResetBtn" type="button">
          Reset Health Reset (today)
        </button>
      </div>

      <div class="footer-note">
        Ever Strong: Define your Strong.
      </div>
    </div>
  </div>

  <!-- Bottom Tabs -->
  <div class="app-tabs" aria-label="App Tabs">
    <div class="app-tabs-inner">
      <button class="app-tab active" data-tab="workout" type="button">Workout</button>
      <button class="app-tab" data-tab="progress" type="button">Progress</button>
      <button class="app-tab" data-tab="measurements" type="button">Measurements</button>
      <button class="app-tab" data-tab="reset" type="button">Health Reset</button>
    </div>
  </div>

  <!-- Edit Workout Modal -->
  <div class="modal-backdrop" id="editPlanModal">
    <div class="modal">
      <div class="modal-header">
        <strong id="editPlanTitle">Edit Plan</strong>
        <button class="tiny-btn" id="closeEditPlan" type="button">Close</button>
      </div>
      <div class="modal-body">
        <div class="exercise-info" style="margin-bottom:8px;">
          Tip: choose from the list (no typing needed).
        </div>
        <div id="editRows"></div>
        <button class="tiny-btn" id="addRowBtn" type="button">Add exercise</button>
      </div>
      <div class="modal-footer">
        <button class="tiny-btn" id="savePlanBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Edit Health Reset Modal -->
  <div class="modal-backdrop" id="editResetModal">
    <div class="modal">
      <div class="modal-header">
        <strong>Edit Health Reset</strong>
        <button class="tiny-btn" id="closeEditReset" type="button">Close</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>One item per line (you can keep headers like ‚Äú‚Äî Supplements ‚Äî‚Äù)</label>
          <textarea id="resetItemsText" placeholder="‚Äî Morning ‚Äî&#10;Take Synthroid...&#10;&#10;‚Äî Supplements ‚Äî&#10;..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="tiny-btn" id="saveResetItemsBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) Weekly workout plan
    // =========================
    const workoutPlan = {
      Monday: [
        { name: "Lateral Raises", sets: 3, reps: "12‚Äì15", description: "Raise dumbbells out to the sides until shoulder height." },
        { name: "Overhead Dumbbell Press", sets: 3, reps: "10‚Äì12", description: "Press dumbbells overhead from shoulder height." },
        { name: "Tricep Rope Pushdowns", sets: 3, reps: "12‚Äì15", description: "Push the rope attachment down until arms are fully extended." },
        { name: "Overhead Tricep Extension", sets: 3, reps: "10‚Äì12", description: "Extend dumbbell overhead with both hands." },
        { name: "Face Pulls", sets: 3, reps: "12‚Äì15", description: "Pull rope toward face while keeping elbows high." },
        { name: "Tricep Dips", sets: 3, reps: "15", description: "Lower your body by bending arms and press back up on parallel bars or a bench." },
        { name: "Finisher: Light Dumbbell Punches", sets: 2, reps: "1 min w/ 1 min rest", description: "Throw light punches continuously for 1 minute. Rest and repeat." }
      ],
      Tuesday: [
        { name: "Dead Bugs", sets: 3, reps: "10/side", description: "Extend opposite arm and leg while keeping core braced." },
        { name: "Bird Dogs", sets: 3, reps: "10/side", description: "Extend opposite arm and leg, hold briefly, and return." },
        { name: "Pallof Press", sets: 3, reps: "12/side", description: "Press resistance band out from chest and hold." },
        { name: "Glute Bridge", sets: 3, reps: "15", description: "Lift hips while squeezing glutes." },
        { name: "Side-Lying Leg Lifts", sets: 3, reps: "15/side", description: "Lift top leg while lying on your side." },
        { name: "Hip Thrusts", sets: 3, reps: "12‚Äì15", description: "Drive hips up using glutes with back supported." },
        { name: "Standing Kickbacks", sets: 3, reps: "15/side", description: "Kick one leg back while squeezing glutes." },
        { name: "Clamshells", sets: 3, reps: "15/side", description: "Open legs like a clamshell while lying on your side with knees bent." }
      ],
      Wednesday: [
        { name: "Hip Thrusts or Glute Bridges", sets: 3, reps: "12‚Äì15", description: "Drive hips up squeezing glutes." },
        { name: "Reverse Lunges", sets: 3, reps: "12‚Äì15/side", description: "Step backward into a lunge, then return." },
        { name: "Step-Ups (Low Step)", sets: 3, reps: "12/leg", description: "Step onto low platform and return." },
        { name: "Romanian Deadlifts", sets: 3, reps: "12", description: "Hinge at hips with straight legs and lower weights." },
        { name: "Banded Side Steps", sets: 3, reps: "15 steps", description: "Step sideways with band tension around thighs." },
        { name: "Light Leg Extensions", sets: 3, reps: "12‚Äì15", description: "Extend lower legs using machine with light weight." },
        { name: "Calf Raises", sets: 3, reps: "20", description: "Raise heels off floor and slowly lower." }
      ],
      Thursday: [
        { name: "Lat Pulldowns", sets: 3, reps: "10‚Äì12", description: "Pull bar down to chest, squeeze back." },
        { name: "Seated Cable Row", sets: 3, reps: "10‚Äì12", description: "Pull cable toward body while squeezing shoulder blades." },
        { name: "Single-Arm Dumbbell Row", sets: 3, reps: "10/side", description: "Row dumbbell while bracing one hand on a bench." },
        { name: "Hammer Curls", sets: 3, reps: "12‚Äì15", description: "Curl with palms facing each other." },
        { name: "Alternating Curls (Slow)", sets: 3, reps: "10/side", description: "Curl each arm one at a time with control." },
        { name: "Rear Delt Flys", sets: 3, reps: "12‚Äì15", description: "Raise arms out to sides while bent forward." },
        { name: "Finisher: Pulse Curls", sets: 2, reps: "30 sec", description: "Small, fast pulses with very light weight." }
      ],
      Friday: [
        { name: "Plank", sets: 1, reps: "10‚Äì20 sec", description: "Hold body in a straight line, resting on forearms." },
        { name: "Side Plank (Modified)", sets: 1, reps: "10‚Äì20 sec/side", description: "Hold side plank on forearm with knees bent." },
        { name: "Standing Woodchoppers", sets: 3, reps: "12/side", description: "Rotate upper body while pulling resistance across body." },
        { name: "Glute Bridge March", sets: 3, reps: "10/side", description: "Lift one knee at a time while holding bridge." },
        { name: "Bodyweight Squat to Chair", sets: 3, reps: "12", description: "Squat back to touch chair, then rise." },
        { name: "Incline Pushups", sets: 3, reps: "10", description: "Push up from hands on bench or wall." },
        { name: "Banded Rows", sets: 3, reps: "12", description: "Pull resistance band toward body." },
        { name: "Hip Hinges", sets: 3, reps: "12", description: "Bend at hips while keeping back straight." },
        { name: "Stretching / Mobility", sets: 1, reps: "10‚Äì15 min", description: "Mobility flow" }
      ],
      Saturday: [
        { name: "Optional: Light Walk", sets: 1, reps: "20‚Äì40 min" },
        { name: "Stretching / Yoga", sets: 1, reps: "10‚Äì20 min" }
      ],
      Sunday: [
        { name: "Rest / Mobility", sets: 1, reps: "10‚Äì20 min" }
      ]
    };

    // =========================
    // 2) Exercise picker list (includes your plan items)
    // =========================
    const EXERCISE_LIBRARY = [
      // Your current plan (so nothing is missing in the picker)
      "Lateral Raises",
      "Overhead Dumbbell Press",
      "Tricep Rope Pushdowns",
      "Overhead Tricep Extension",
      "Face Pulls",
      "Tricep Dips",
      "Finisher: Light Dumbbell Punches",
      "Dead Bugs",
      "Bird Dogs",
      "Pallof Press",
      "Glute Bridge",
      "Side-Lying Leg Lifts",
      "Hip Thrusts",
      "Standing Kickbacks",
      "Clamshells",
      "Hip Thrusts or Glute Bridges",
      "Reverse Lunges",
      "Step-Ups (Low Step)",
      "Romanian Deadlifts",
      "Banded Side Steps",
      "Light Leg Extensions",
      "Calf Raises",
      "Lat Pulldowns",
      "Seated Cable Row",
      "Single-Arm Dumbbell Row",
      "Hammer Curls",
      "Alternating Curls (Slow)",
      "Rear Delt Flys",
      "Finisher: Pulse Curls",
      "Plank",
      "Side Plank (Modified)",
      "Standing Woodchoppers",
      "Glute Bridge March",
      "Bodyweight Squat to Chair",
      "Incline Pushups",
      "Banded Rows",
      "Hip Hinges",
      "Stretching / Mobility",
      "Stretching / Yoga",
      "Rest / Mobility",
      "Optional: Light Walk",

      // Extra common options (nice to have)
      "Incline Dumbbell Press",
      "Dumbbell Bench Press",
      "Push-Ups",
      "Incline Push-Ups",
      "Lat Pulldown",
      "Dumbbell Row",
      "Bent-Over Row",
      "Dumbbell Shoulder Press",
      "Front Raises",
      "Biceps Curls",
      "Triceps Rope Pushdown",
      "Overhead Triceps Extension",
      "Goblet Squat",
      "Glute Bridge/Hip Thrust",
      "Leg Press",
      "Step-Ups",
      "Lunges",
      "Split Squats",
      "Hamstring Curl",
      "Walking Treadmill"
    ];

    // =========================
    // 3) Mobility help (underline explanation)
    // =========================
    const MOBILITY_HELP_HTML = `
      <p><strong>Quick 10‚Äì12 minute mobility flow</strong></p>
      <ul>
        <li>Chest opener stretch (doorway) ‚Äì 45 sec</li>
        <li>Child‚Äôs pose ‚Äì 45 sec</li>
        <li>Hip flexor stretch ‚Äì 45 sec/side</li>
        <li>Figure-4 glute stretch ‚Äì 45 sec/side</li>
        <li>Hamstring stretch ‚Äì 45 sec/side</li>
        <li>Thoracic rotation (‚Äúopen books‚Äù) ‚Äì 8 reps/side</li>
        <li>Calf stretch ‚Äì 30‚Äì45 sec/side</li>
      </ul>
      <p style="margin-top:12px;">If knees are cranky: do hip + upper body stretches more, less deep knee bending.</p>
    `;

    function isMobilityExercise(name){
      return /mobility/i.test(name || "");
    }

    // =========================
    // 4) State & helpers
    // =========================
    const days = Object.keys(workoutPlan);
    const today = new Date();
    const todayDateStr = today.toISOString().slice(0, 10);

    const dayTabsEl = document.getElementById("dayTabs");
    const currentDayLabelEl = document.getElementById("currentDayLabel");
    const currentDateLabelEl = document.getElementById("currentDateLabel");
    const exerciseListEl = document.getElementById("exerciseList");
    const completionBadgeEl = document.getElementById("completionBadge");
    const resetDayBtn = document.getElementById("resetDayBtn");

    // tabs
    const tabWorkout = document.getElementById("tab-workout");
    const tabProgress = document.getElementById("tab-progress");
    const tabMeasurements = document.getElementById("tab-measurements");
    const tabReset = document.getElementById("tab-reset");
    const appTabs = Array.from(document.querySelectorAll(".app-tab"));

    // progress
    const progressBadge = document.getElementById("progressBadge");
    const weekSummary = document.getElementById("weekSummary");
    const streakSummary = document.getElementById("streakSummary");
    const todayProgressBar = document.getElementById("todayProgressBar");
    const todayProgressText = document.getElementById("todayProgressText");
    const todayProgressPct = document.getElementById("todayProgressPct");

    const weekProgressBar = document.getElementById("weekProgressBar");
    const weekProgressText = document.getElementById("weekProgressText");
    const weekProgressPct = document.getElementById("weekProgressPct");


    // measurements
    const mDate = document.getElementById("mDate");
    const mWeight = document.getElementById("mWeight");
    const mWaist = document.getElementById("mWaist");
    const mHips = document.getElementById("mHips");
    const mChest = document.getElementById("mChest");
    const mNotes = document.getElementById("mNotes");
    const measBadge = document.getElementById("measBadge");
    const saveMeasurementBtn = document.getElementById("saveMeasurementBtn");
    const viewMeasurementsBtn = document.getElementById("viewMeasurementsBtn");
    const measurementsList = document.getElementById("measurementsList");

    // health reset
    const resetList = document.getElementById("resetList");
    const resetBadge = document.getElementById("resetBadge");
    const resetResetBtn = document.getElementById("resetResetBtn");
    const editResetBtn = document.getElementById("editResetBtn");

    // edit plan modal
    const editPlanBtn = document.getElementById("editPlanBtn");
    const editPlanModal = document.getElementById("editPlanModal");
    const editPlanTitle = document.getElementById("editPlanTitle");
    const closeEditPlan = document.getElementById("closeEditPlan");
    const editRows = document.getElementById("editRows");
    const addRowBtn = document.getElementById("addRowBtn");
    const savePlanBtn = document.getElementById("savePlanBtn");

    // edit reset modal
    const editResetModal = document.getElementById("editResetModal");
    const closeEditReset = document.getElementById("closeEditReset");
    const resetItemsText = document.getElementById("resetItemsText");
    const saveResetItemsBtn = document.getElementById("saveResetItemsBtn");

    let currentDay = getDefaultDay();
    let activeMainTab = loadMainTab() || "workout";

    function getDefaultDay() {
      const weekday = today.getDay();
      const map = [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ];
      return map[weekday] || "Monday";
    }

    // ===== Storage keys =====
    function getWorkoutProgressKey(day) { return "workoutProgress_" + day + "_" + todayDateStr; }
    function getPlanKey(day){ return "everStrong_plan_" + day; }
    function getResetItemsKey(){ return "everStrong_resetItems"; }
    function getResetStateKey(){ return "everStrong_resetState_" + todayDateStr; }
    function getMeasurementsKey(){ return "everStrong_measurements"; }
    function getMainTabKey(){ return "everStrong_mainTab"; }

    function loadMainTab(){ return localStorage.getItem(getMainTabKey()); }
    function saveMainTab(name){ localStorage.setItem(getMainTabKey(), name); }

    // ===== Workout progress =====
    function loadProgress(day) {
      const raw = localStorage.getItem(getWorkoutProgressKey(day));
      if (!raw) return {};
      try { return JSON.parse(raw); } catch { return {}; }
    }
    function saveProgress(day, progress) {
      localStorage.setItem(getWorkoutProgressKey(day), JSON.stringify(progress));
    }

    // ===== Plan overrides =====
    function loadPlanOverride(day){
      const raw = localStorage.getItem(getPlanKey(day));
      if(!raw) return null;
      try { return JSON.parse(raw); } catch { return null; }
    }
    function savePlanOverride(day, planArr){
      localStorage.setItem(getPlanKey(day), JSON.stringify(planArr));
    }
    function getPlanForDay(day){
      return loadPlanOverride(day) || workoutPlan[day] || [];
    }

    // ===== Measurements =====
    function loadMeasurements(){
      const raw = localStorage.getItem(getMeasurementsKey());
      if(!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch { return []; }
    }
    function saveMeasurements(arr){
      localStorage.setItem(getMeasurementsKey(), JSON.stringify(arr));
    }

    // =========================
    // 5) Render helpers
    // =========================
    function renderDateLabel() {
      const opts = { weekday: "long", year: "numeric", month: "short", day: "numeric" };
      currentDateLabelEl.textContent = today.toLocaleDateString(undefined, opts);
    }

    function renderDayTabs() {
      dayTabsEl.innerHTML = "";
      days.forEach(day => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = day.slice(0, 3);
        btn.className = "day-tab" + (day === currentDay ? " active" : "");
        btn.addEventListener("click", () => {
          currentDay = day;
          render();
        });
        dayTabsEl.appendChild(btn);
      });
    }

    function renderExercises() {
      const exercises = getPlanForDay(currentDay);
      const progress = loadProgress(currentDay);
      exerciseListEl.innerHTML = "";

      let completedCount = 0;

      exercises.forEach((ex, index) => {
        const exKey = String(index);
        const exState = progress[exKey] || { done: false, weight: "", notes: "" };
        if (exState.done) completedCount++;

        const wrapper = document.createElement("div");
        wrapper.className = "exercise";

        const header = document.createElement("div");
        header.className = "exercise-header";

        const nameDiv = document.createElement("div");
        nameDiv.innerHTML = `
          <div class="exercise-name">${ex.name}</div>
          <div class="exercise-info">${ex.sets} sets ‚Ä¢ ${ex.reps}</div>
        `;

        const doneDiv = document.createElement("label");
        doneDiv.className = "done-toggle";
        const doneCheckbox = document.createElement("input");
        doneCheckbox.type = "checkbox";
        doneCheckbox.checked = !!exState.done;
        const doneSpan = document.createElement("span");
        doneSpan.textContent = "Done";

        doneDiv.appendChild(doneCheckbox);
        doneDiv.appendChild(doneSpan);

        header.appendChild(nameDiv);
        header.appendChild(doneDiv);

        const controls = document.createElement("div");
        controls.className = "exercise-controls";

        const weightGroup = document.createElement("div");
        weightGroup.className = "form-group";
        const weightLabel = document.createElement("label");
        weightLabel.textContent = "Weight / Level";
        const weightInput = document.createElement("input");
        weightInput.type = "text";
        weightInput.value = exState.weight || "";
        weightInput.placeholder = "e.g. 15 lb DBs";
        weightGroup.appendChild(weightLabel);
        weightGroup.appendChild(weightInput);

        const notesGroup = document.createElement("div");
        notesGroup.className = "form-group";
        const notesLabel = document.createElement("label");
        notesLabel.textContent = "Notes";
        const notesInput = document.createElement("textarea");
        notesInput.value = exState.notes || "";
        notesInput.placeholder = "How it felt, tweaks, etc.";
        notesGroup.appendChild(notesLabel);
        notesGroup.appendChild(notesInput);

        controls.appendChild(weightGroup);
        controls.appendChild(notesGroup);

        function updateState() {
          const newState = loadProgress(currentDay);
          newState[exKey] = {
            done: doneCheckbox.checked,
            weight: weightInput.value || "",
            notes: notesInput.value || ""
          };
          saveProgress(currentDay, newState);
          updateCompletionBadge(exercises.length, countCompleted(exercises.length, newState));
        }

        doneCheckbox.addEventListener("change", updateState);
        weightInput.addEventListener("change", updateState);
        notesInput.addEventListener("change", updateState);
        notesInput.addEventListener("blur", updateState);

        wrapper.appendChild(header);
        wrapper.appendChild(controls);

        // Mobility underline explanation (ONLY for Mobility items)
        if (isMobilityExercise(ex.name)) {
          const link = document.createElement("div");
          link.className = "circuit-link";
          link.textContent = "What does this mean? (Mobility flow)";

          const help = document.createElement("div");
          help.className = "circuit-help";
          help.innerHTML = MOBILITY_HELP_HTML;

          link.addEventListener("click", () => {
            help.style.display = (help.style.display === "block") ? "none" : "block";
          });

          wrapper.appendChild(link);
          wrapper.appendChild(help);
        }

        exerciseListEl.appendChild(wrapper);
      });

      updateCompletionBadge(exercises.length, completedCount);
    }

    function countCompleted(total, progressObj) {
      let c = 0;
      for (let i = 0; i < total; i++) {
        const st = progressObj[String(i)];
        if (st && st.done) c++;
      }
      return c;
    }

    function updateCompletionBadge(total, completed) {
      if (total === 0) {
        completionBadgeEl.textContent = "No workout set";
        completionBadgeEl.className = "badge badge-incomplete";
        return;
      }
      if (completed >= total) {
        completionBadgeEl.textContent = "All done ‚úî";
        completionBadgeEl.className = "badge badge-complete";
      } else {
        completionBadgeEl.textContent = `${completed}/${total} done`;
        completionBadgeEl.className = "badge badge-incomplete";
      }
    }

    // =========================
    // 6) Bottom tabs logic
    // =========================
    function setMainTab(name){
      activeMainTab = name;
      saveMainTab(name);

      tabWorkout.classList.toggle("hidden", name !== "workout");
      tabProgress.classList.toggle("hidden", name !== "progress");
      tabMeasurements.classList.toggle("hidden", name !== "measurements");
      tabReset.classList.toggle("hidden", name !== "reset");

      appTabs.forEach(b => b.classList.toggle("active", b.dataset.tab === name));

      if(name === "workout") render();
      if(name === "progress") renderProgress();
      if(name === "measurements") renderMeasurements();
      if(name === "reset") renderHealthReset();
    }

    appTabs.forEach(btn => btn.addEventListener("click", () => setMainTab(btn.dataset.tab)));

    // =========================
    // 7) Progress tab (simple)
    // =========================
   function renderProgress(){
  // ---- TODAY (uses currentDay) ----
  const todayPlan = getPlanForDay(currentDay);
  const prog = loadProgress(currentDay);
  const total = todayPlan.length;
  const done = countCompleted(total, prog);

  progressBadge.textContent = total ? `${done}/${total} today` : "‚Äî";

  const pct = total ? Math.round((done / total) * 100) : 0;
  todayProgressBar.style.width = pct + "%";
  todayProgressPct.textContent = pct + "%";
  todayProgressText.textContent = total ? `Today: ${done} of ${total} completed` : "No workout set for today";

  // ---- WEEK (all days) ----
  let weekTotal = 0, weekDone = 0;
  days.forEach(d => {
    const plan = getPlanForDay(d);
    const p = loadProgress(d);
    weekTotal += plan.length;
    weekDone += countCompleted(plan.length, p);
  });

  weekSummary.textContent = weekTotal
    ? `${weekDone} of ${weekTotal} exercises completed (based on this week's plan).`
    : "‚Äî";

  const weekPct = weekTotal ? Math.round((weekDone / weekTotal) * 100) : 0;
  weekProgressBar.style.width = weekPct + "%";
  weekProgressPct.textContent = weekPct + "%";
  weekProgressText.textContent = weekTotal
    ? `Week: ${weekDone} of ${weekTotal} completed`
    : "No workouts set this week";

  // ---- STREAK (same placeholder as before) ----
  if(total && done === total) {
    streakSummary.textContent = "Today complete ‚úî";
  } else {
    streakSummary.textContent = "‚Äî";
  }
}


    // =========================
    // 8) Measurements tab
    // =========================
    function renderMeasurements(){
      measBadge.textContent = "Saved";
      mDate.value = mDate.value || todayDateStr;
      measurementsList.classList.add("hidden");
      measurementsList.innerHTML = "";
    }

    saveMeasurementBtn.addEventListener("click", () => {
      const rec = {
        date: mDate.value || todayDateStr,
        weight: mWeight.value || "",
        waist: mWaist.value || "",
        hips: mHips.value || "",
        chest: mChest.value || "",
        notes: mNotes.value || ""
      };
      const arr = loadMeasurements();
      arr.unshift(rec);
      saveMeasurements(arr);

      measBadge.textContent = "Saved ‚úî";
      mWeight.value = "";
      mWaist.value = "";
      mHips.value = "";
      mChest.value = "";
      mNotes.value = "";
    });

    viewMeasurementsBtn.addEventListener("click", () => {
      const arr = loadMeasurements();
      if(!arr.length){
        measurementsList.classList.remove("hidden");
        measurementsList.textContent = "No saved measurements yet.";
        return;
      }
      const lines = arr.slice(0, 25).map(r => {
        return `${r.date} | wt:${r.weight} waist:${r.waist} hips:${r.hips} chest:${r.chest}${r.notes ? " | " + r.notes : ""}`;
      });
      measurementsList.classList.remove("hidden");
      measurementsList.textContent = lines.join("\n");
      measurementsList.style.whiteSpace = "pre-wrap";
      measurementsList.style.fontSize = "0.8rem";
      measurementsList.style.color = "var(--muted)";
    });

    // =========================
    // 9) Health Reset tab + edit (full rewrite)
    // =========================
    const RESET_DEFAULTS = {
      morning: [
        "Take Synthroid early morning (empty stomach).",
        "Wait 45‚Äì60 min before food/coffee.",
        "Hydrate (water)."
      ],
      supps: [
        "5:00 AM: Perfect Amino (before 5:30 workout).",
        "Daily: Good Girl Probiotic.",
        "Daily: MultiComplete multivitamin.",
        "Daily: Omega-3.",
        "Daily: NAD+.",
        "Daily: HUM.",
        "Daily: Collagen + Peptides.",
        "Later in day: Citrucel (separate from Synthroid).",
        "Before bed: Magnesium."
      ],
      rules: [
        "Protein-forward meals.",
        "Walk breaks (2 √ó 15 min).",
        "Sleep goal: 7+ hours.",
        "Consistency over perfection."
      ]
    };

    function buildResetDefaultLines() {
      return [
        "‚Äî Morning ‚Äî",
        ...RESET_DEFAULTS.morning,
        "",
        "‚Äî Supplements ‚Äî",
        ...RESET_DEFAULTS.supps,
        "",
        "‚Äî Rules ‚Äî",
        ...RESET_DEFAULTS.rules
      ];
    }

    function isResetHeaderLine(txt) {
      return /^‚Äî\s.*\s‚Äî$/.test((txt || "").trim());
    }
    function isResetBlankLine(txt) {
      return (txt || "").trim() === "";
    }
    function isResetCheckable(txt) {
      return !isResetHeaderLine(txt) && !isResetBlankLine(txt);
    }

    function loadResetItems(){
      const raw = localStorage.getItem(getResetItemsKey());
      const defaults = buildResetDefaultLines();
      if(!raw) return defaults;

      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) && arr.length ? arr : defaults;
      } catch {
        return defaults;
      }
    }

    function saveResetItems(arr){
      localStorage.setItem(getResetItemsKey(), JSON.stringify(arr));
    }

    function loadResetState(){
      const raw = localStorage.getItem(getResetStateKey());
      const items = loadResetItems();

      if(!raw) return { checks: items.map(() => false), notes: "" };

      try {
        const st = JSON.parse(raw);
        if(!st || typeof st !== "object") throw new Error("bad state");
        if(!Array.isArray(st.checks)) st.checks = [];
        if(typeof st.notes !== "string") st.notes = "";

        if(st.checks.length !== items.length) {
          st.checks = items.map((txt, i) => (isResetCheckable(txt) ? !!st.checks[i] : false));
        }
        return st;
      } catch {
        return { checks: items.map(() => false), notes: "" };
      }
    }

    function saveResetState(st){
      localStorage.setItem(getResetStateKey(), JSON.stringify(st));
    }

    function renderHealthReset(){
      const items = loadResetItems();
      const st = loadResetState();

      if(!Array.isArray(st.checks)) st.checks = [];
      if(st.checks.length !== items.length){
        st.checks = items.map((txt, i) => (isResetCheckable(txt) ? !!st.checks[i] : false));
        saveResetState(st);
      }

      resetList.innerHTML = "";

      let done = 0;
      let totalCheckable = 0;

      items.forEach((txt, idx) => {
        const row = document.createElement("div");
        row.className = "exercise";

        // Headers
        if (isResetHeaderLine(txt)) {
          row.style.padding = "6px 8px";
          const t = document.createElement("div");
          t.className = "exercise-name";
          t.textContent = txt;
          t.style.fontSize = "0.85rem";
          t.style.fontWeight = "700";
          row.appendChild(t);
          resetList.appendChild(row);
          return;
        }

        // Blank line spacer
        if (isResetBlankLine(txt)) {
          row.style.border = "none";
          row.style.background = "transparent";
          row.style.padding = "2px";
          row.style.marginBottom = "6px";
          resetList.appendChild(row);
          return;
        }

        // Checkable
        totalCheckable++;

        const header = document.createElement("div");
        header.className = "exercise-header";

        const name = document.createElement("div");
        name.className = "exercise-name";
        name.style.fontSize = "0.9rem";
        name.textContent = txt;

        const doneDiv = document.createElement("label");
        doneDiv.className = "done-toggle";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!st.checks[idx];
        const sp = document.createElement("span");
        sp.textContent = "Done";
        doneDiv.appendChild(cb);
        doneDiv.appendChild(sp);

        header.appendChild(name);
        header.appendChild(doneDiv);

        cb.addEventListener("change", () => {
          const st2 = loadResetState();
          st2.checks[idx] = cb.checked;
          saveResetState(st2);
          renderHealthReset();
        });

        row.appendChild(header);
        resetList.appendChild(row);

        if(cb.checked) done++;
      });

      resetBadge.textContent = `${done}/${totalCheckable}`;

      // Notes box
      const notesWrap = document.createElement("div");
      notesWrap.className = "exercise";
      const notesLabel = document.createElement("div");
      notesLabel.className = "exercise-name";
      notesLabel.style.fontSize = "0.9rem";
      notesLabel.textContent = "Notes";
      const notesBox = document.createElement("textarea");
      notesBox.style.fontSize = "0.8rem";
      notesBox.style.border = "1px solid var(--border)";
      notesBox.style.borderRadius = "6px";
      notesBox.style.padding = "6px";
      notesBox.style.minHeight = "50px";
      notesBox.placeholder = "How you feel, wins, symptoms, etc.";
      notesBox.value = st.notes || "";
      notesBox.addEventListener("blur", () => {
        const st2 = loadResetState();
        st2.notes = notesBox.value || "";
        saveResetState(st2);
      });
      notesWrap.appendChild(notesLabel);
      notesWrap.appendChild(notesBox);
      resetList.appendChild(notesWrap);
    }

    resetResetBtn.addEventListener("click", () => {
      if (!confirm("Reset Health Reset for today?")) return;
      const items = loadResetItems();
      saveResetState({ checks: items.map(() => false), notes: "" });
      renderHealthReset();
    });

    editResetBtn.addEventListener("click", () => {
      const items = loadResetItems();
      resetItemsText.value = items.join("\n");
      openModal(editResetModal);
    });

    saveResetItemsBtn.addEventListener("click", () => {
      const lines = resetItemsText.value
        .split("\n")
        .map(s => s.replace(/\s+$/g, "")); // keep blanks + headers

      const hasAnyContent = lines.some(s => s.trim().length > 0);
      const finalItems = hasAnyContent ? lines : buildResetDefaultLines();

      saveResetItems(finalItems);

      const st = loadResetState();
      st.checks = finalItems.map((txt, i) => (isResetCheckable(txt) ? !!st.checks[i] : false));
      saveResetState(st);

      closeModal(editResetModal);
      renderHealthReset();
    });

    closeEditReset.addEventListener("click", () => closeModal(editResetModal));

    // =========================
    // 10) Edit Plan modal (dropdown ONLY)
    // =========================
    function openEditPlan(){
      editPlanTitle.textContent = `Edit Plan: ${currentDay}`;
      editRows.innerHTML = "";

      const plan = JSON.parse(JSON.stringify(getPlanForDay(currentDay)));

      function makeRow(item){
        const row = document.createElement("div");
        row.className = "row";

        const top = document.createElement("div");
        top.className = "row-top";

        const fg1 = document.createElement("div");
        fg1.className = "form-group";
        fg1.style.flex = "1 1 220px";
        const l1 = document.createElement("label");
        l1.textContent = "Exercise";
        const sel = document.createElement("select");

        EXERCISE_LIBRARY.forEach(n => {
          const o = document.createElement("option");
          o.value = n;
          o.textContent = n;
          sel.appendChild(o);
        });

        // Set initial selection (fallback to first)
        if (EXERCISE_LIBRARY.includes(item.name)) {
          sel.value = item.name;
        } else {
          sel.value = EXERCISE_LIBRARY[0] || "";
          item.name = sel.value;
        }

        sel.addEventListener("change", () => {
          item.name = sel.value;
        });

        fg1.appendChild(l1);
        fg1.appendChild(sel);

        const fg2 = document.createElement("div");
        fg2.className = "form-group";
        fg2.style.flex = "0 0 80px";
        const l2 = document.createElement("label");
        l2.textContent = "Sets";
        const sets = document.createElement("input");
        sets.type = "text";
        sets.value = item.sets ?? "";
        sets.addEventListener("input", () => item.sets = sets.value);
        fg2.appendChild(l2);
        fg2.appendChild(sets);

        const fg3 = document.createElement("div");
        fg3.className = "form-group";
        fg3.style.flex = "1 1 140px";
        const l3 = document.createElement("label");
        l3.textContent = "Reps";
        const reps = document.createElement("input");
        reps.type = "text";
        reps.value = item.reps ?? "";
        reps.addEventListener("input", () => item.reps = reps.value);
        fg3.appendChild(l3);
        fg3.appendChild(reps);

        top.appendChild(fg1);
        top.appendChild(fg2);
        top.appendChild(fg3);

        const actions = document.createElement("div");
        actions.className = "row-actions";
        const remove = document.createElement("button");
        remove.type = "button";
        remove.className = "tiny-btn";
        remove.textContent = "Remove";
        remove.addEventListener("click", () => {
          const idx = plan.indexOf(item);
          if(idx >= 0) plan.splice(idx, 1);
          openEditPlan();
        });
        actions.appendChild(remove);

        row.appendChild(top);
        row.appendChild(actions);

        return row;
      }

      plan.forEach(item => editRows.appendChild(makeRow(item)));

      addRowBtn.onclick = () => {
        plan.push({ name: EXERCISE_LIBRARY[0] || "Lateral Raises", sets: 3, reps: "10‚Äì12" });
        openEditPlan();
      };

      savePlanBtn.onclick = () => {
        const cleaned = plan
          .map(x => ({
            name: (x.name || "").trim(),
            sets: x.sets || 3,
            reps: (x.reps || "").trim()
          }))
          .filter(x => x.name);

        savePlanOverride(currentDay, cleaned);
        closeModal(editPlanModal);
        render();
      };

      openModal(editPlanModal);
    }

    editPlanBtn.addEventListener("click", openEditPlan);
    closeEditPlan.addEventListener("click", () => closeModal(editPlanModal));

    // =========================
    // 11) Reset button (workout)
    // =========================
    resetDayBtn.addEventListener("click", () => {
      if (!confirm(`Reset all progress for ${currentDay} (today only)?`)) return;
      saveProgress(currentDay, {});
      renderExercises();
    });

    // =========================
    // 12) Modal helpers
    // =========================
    function openModal(el){ el.style.display = "flex"; }
    function closeModal(el){ el.style.display = "none"; }

    [editPlanModal, editResetModal].forEach(backdrop => {
      backdrop.addEventListener("click", (e) => {
        if(e.target === backdrop) closeModal(backdrop);
      });
    });

    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape"){
        closeModal(editPlanModal);
        closeModal(editResetModal);
      }
    });

    // =========================
    // 13) Main render (workout tab)
    // =========================
    function render() {
      renderDayTabs();
      currentDayLabelEl.textContent = currentDay + " workout";
      renderExercises();
    }

    // Initial render
    renderDateLabel();
    setMainTab(activeMainTab);
    render();
  </script>
</body>
</html>




