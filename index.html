<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Daily Workout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA / App meta -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2c7be5" />
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --accent: #2c7be5;
      --accent-soft: #e1edff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --danger: #ef4444;
      --success: #10b981;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top left, #eef2ff 0, #f9fafb 45%, #f5f5f7 100%);
      color: var(--text);
      padding: 12px;
    }

    .app {
      max-width: 520px;
      margin: 0 auto;
    }

    header {
      text-align: left;
      margin-bottom: 10px;
    }

    header h1 {
      font-size: 1.5rem;
      margin: 0 0 4px 0;
      letter-spacing: 0.03em;
    }

    header p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .date-label {
      margin-top: 4px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* Top nav tabs: Workout / Progress / Week Summary */
    .top-nav {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin: 12px 0;
      background: rgba(255,255,255,0.7);
      padding: 4px;
      border-radius: 999px;
      box-shadow: 0 1px 3px rgba(15,23,42,0.08);
    }

    .nav-tab {
      border-radius: 999px;
      border: none;
      padding: 6px 4px;
      font-size: 0.8rem;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
    }

    .nav-tab.active {
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      box-shadow: 0 1px 4px rgba(37,99,235,0.4);
    }

    .view {
      display: none;
    }
    .view.active {
      display: block;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.08);
      margin-bottom: 14px;
      border: 1px solid rgba(148,163,184,0.15);
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .chip {
      font-size: 0.75rem;
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: #f9fafb;
    }

    .chip-success {
      color: var(--success);
      border-color: var(--success);
      background: #ecfdf5;
    }

    .chip-danger {
      color: var(--danger);
      border-color: var(--danger);
      background: #fef2f2;
    }

    .subtext {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    /* Workout view */
    .day-tabs {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 6px;
      margin: 4px 0 10px 0;
      padding-bottom: 4px;
    }

    .day-tab {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 0.8rem;
      background: #fff;
      white-space: nowrap;
      cursor: pointer;
      flex: 0 0 auto;
      color: var(--muted);
    }

    .day-tab.active {
      background: var(--accent-soft);
      color: #1d4ed8;
      border-color: #bfdbfe;
      font-weight: 600;
    }

    .workout-summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .exercise {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 8px;
      margin-bottom: 8px;
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .exercise-name {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .exercise-info {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .exercise-controls {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      flex: 1 1 120px;
    }

    .form-group label {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      font-size: 0.8rem;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid var(--border);
      width: 100%;
      background: #f9fafb;
    }

    .form-group textarea {
      min-height: 40px;
      resize: vertical;
    }

    .done-toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: #f9fafb;
    }

    .done-toggle input {
      width: 18px;
      height: 18px;
    }

    .reset-btn {
      margin-top: 4px;
      font-size: 0.75rem;
      background: none;
      border: none;
      color: var(--danger);
      text-decoration: underline;
      cursor: pointer;
      padding: 0;
    }

    .footer-note {
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Progress view */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .btn-primary {
      margin-top: 8px;
      width: 100%;
      border-radius: 999px;
      padding: 8px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(37,99,235,0.4);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(37,99,235,0.5);
    }

    .recent-list {
      margin-top: 6px;
      border-top: 1px dashed var(--border);
      padding-top: 6px;
    }

    .recent-item {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 4px 0;
      font-size: 0.8rem;
      border-bottom: 1px dashed rgba(229,231,235,0.6);
    }

    .recent-item span.key {
      color: var(--muted);
    }

    .small-pill {
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      padding: 1px 6px;
      font-size: 0.7rem;
    }

    /* Week summary view */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .summary-stat {
      border-radius: 12px;
      padding: 8px;
      background: #f9fafb;
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }

    .summary-stat .label {
      color: var(--muted);
      margin-bottom: 2px;
    }

    .summary-stat .value {
      font-size: 1rem;
      font-weight: 700;
    }

    .summary-week-list {
      margin-top: 8px;
      border-top: 1px dashed var(--border);
      padding-top: 6px;
      font-size: 0.8rem;
    }

    .summary-week-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      border-bottom: 1px dashed rgba(229,231,235,0.6);
    }

    .summary-week-row .day {
      font-weight: 500;
    }

    .summary-week-row .count {
      color: var(--muted);
    }

    .tag-complete {
      padding: 1px 6px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      font-size: 0.7rem;
    }

    .tag-miss {
      padding: 1px 6px;
      border-radius: 999px;
      background: #fef2f2;
      color: #b91c1c;
      font-size: 0.7rem;
    }

    /* Scrollbar styling for day tabs */
    .day-tabs::-webkit-scrollbar {
      height: 4px;
    }
    .day-tabs::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 999px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>My Daily Workout</h1>
      <p>Your simple, focused workout + progress tracker.</p>
      <div class="date-label" id="currentDateLabel"></div>
    </header>

    <div class="top-nav">
      <button class="nav-tab active" data-view="workout">Workout</button>
      <button class="nav-tab" data-view="progress">Progress</button>
      <button class="nav-tab" data-view="summary">Week Summary</button>
    </div>

    <!-- Workout view -->
    <section id="view-workout" class="view active">
      <div class="card">
        <div class="card-title-row">
          <div class="card-title" id="currentDayLabel"></div>
          <span class="chip" id="completionBadge"></span>
        </div>
        <div class="subtext">Tap a day, check off sets, and jot quick notes.</div>

        <div class="day-tabs" id="dayTabs"></div>

        <div id="exerciseList"></div>

        <button class="reset-btn" id="resetDayBtn" type="button">
          Reset this day’s progress (today only)
        </button>
      </div>
    </section>

    <!-- Progress view -->
    <section id="view-progress" class="view">
      <div class="card">
        <div class="card-title-row">
          <div class="card-title">Measurements & Weight</div>
          <span class="chip">Saved on this device</span>
        </div>
        <div class="subtext">
          Log weight & key measurements to see changes over time.
        </div>

        <div class="form-group">
          <label for="progressDate">Date</label>
          <input type="date" id="progressDate">
        </div>

        <div class="grid-2" style="margin-top:6px;">
          <div class="form-group">
            <label for="weightInput">Weight (lb)</label>
            <input type="number" id="weightInput" inputmode="decimal" step="0.1" placeholder="e.g. 160">
          </div>
          <div class="form-group">
            <label for="waistInput">Waist (in)</label>
            <input type="number" id="waistInput" inputmode="decimal" step="0.1" placeholder="e.g. 30">
          </div>
          <div class="form-group">
            <label for="hipsInput">Hips (in)</label>
            <input type="number" id="hipsInput" inputmode="decimal" step="0.1">
          </div>
          <div class="form-group">
            <label for="chestInput">Chest (in)</label>
            <input type="number" id="chestInput" inputmode="decimal" step="0.1">
          </div>
          <div class="form-group">
            <label for="rArmInput">Right arm (in)</label>
            <input type="number" id="rArmInput" inputmode="decimal" step="0.1">
          </div>
          <div class="form-group">
            <label for="lArmInput">Left arm (in)</label>
            <input type="number" id="lArmInput" inputmode="decimal" step="0.1">
          </div>
        </div>

        <button class="btn-primary" id="saveProgressBtn" type="button">
          Save today’s measurements
        </button>

        <div class="recent-list" id="recentProgressList">
          <!-- recent entries injected here -->
        </div>
      </div>
    </section>

    <!-- Week summary view -->
    <section id="view-summary" class="view">
      <div class="card">
        <div class="card-title-row">
          <div class="card-title">This Week at a Glance</div>
          <span class="chip" id="weekRangeLabel"></span>
        </div>
        <div class="subtext">
          Based on workouts you’ve checked off and logged measurements on this device.
        </div>

        <div class="summary-grid">
          <div class="summary-stat">
            <div class="label">Workout days</div>
            <div class="value" id="statWorkoutDays">0/7</div>
          </div>
          <div class="summary-stat">
            <div class="label">Total exercises done</div>
            <div class="value" id="statTotalExercises">0</div>
          </div>
          <div class="summary-stat">
            <div class="label">Latest weight</div>
            <div class="value" id="statLatestWeight">–</div>
            <div class="label" id="statWeightChange"></div>
          </div>
          <div class="summary-stat">
            <div class="label">Latest waist</div>
            <div class="value" id="statLatestWaist">–</div>
          </div>
        </div>

        <div class="summary-week-list" id="weekDayBreakdown">
          <!-- rows per day -->
        </div>
      </div>
    </section>

    <div class="footer-note">
      All data is stored locally in your browser on this device only.
    </div>
  </div>

  <script>
    // ==== 1. Workout plan ====
    const workoutPlan = {
      Monday: [
        { name: "Incline Dumbbell Press", sets: 3, reps: "10–12" },
        { name: "Lat Pulldown", sets: 3, reps: "10–12" },
        { name: "Dumbbell Shoulder Press", sets: 3, reps: "10–12" },
        { name: "Triceps Rope Pushdown", sets: 3, reps: "12–15" },
        { name: "Walking Treadmill", sets: 1, reps: "20–30 min" }
      ],
      Tuesday: [
        { name: "Goblet Squat", sets: 3, reps: "10–12" },
        { name: "Romanian Deadlift", sets: 3, reps: "10–12" },
        { name: "Glute Bridge/Hip Thrust", sets: 3, reps: "12–15" },
        { name: "Calf Raises", sets: 3, reps: "15–20" },
        { name: "Walking Treadmill", sets: 1, reps: "20–30 min" }
      ],
      Wednesday: [
        { name: "Push-Ups / Incline Push-Ups", sets: 3, reps: "As many as possible" },
        { name: "Dumbbell Row", sets: 3, reps: "10–12" },
        { name: "Lateral Raises", sets: 3, reps: "12–15" },
        { name: "Biceps Curls", sets: 3, reps: "10–12" },
        { name: "Core Circuit", sets: 3, reps: "3–4 exercises" }
      ],
      Thursday: [
        { name: "Leg Press or Step-Ups", sets: 3, reps: "10–12" },
        { name: "Lunges (or split squats)", sets: 3, reps: "10–12/leg" },
        { name: "Hamstring Curl", sets: 3, reps: "10–12" },
        { name: "Core Circuit", sets: 3, reps: "3–4 exercises" },
        { name: "Walking Treadmill", sets: 1, reps: "20–30 min" }
      ],
      Friday: [
        { name: "Full-Body Circuit", sets: 3, reps: "8–10 exercises" },
        { name: "Extra Arms / Glutes", sets: 2, reps: "Choose your favs" },
        { name: "Stretching / Mobility", sets: 1, reps: "10–15 min" },
        { name: "Walking Treadmill", sets: 1, reps: "20–30 min" }
      ],
      Saturday: [
        { name: "Optional: Light Walk", sets: 1, reps: "20–40 min" },
        { name: "Stretching / Yoga", sets: 1, reps: "10–20 min" }
      ],
      Sunday: [
        { name: "Rest / Mobility", sets: 1, reps: "10–20 min" }
      ]
    };

    // ==== 2. Shared date helpers ====
    const daysOfWeek = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    function toDateStr(d) {
      return d.toISOString().slice(0,10); // YYYY-MM-DD
    }

    function getToday() {
      return new Date();
    }

    // ==== 3. Workout view state ====
    const today = getToday();
    const todayDateStr = toDateStr(today);

    const dayTabsEl = document.getElementById("dayTabs");
    const currentDayLabelEl = document.getElementById("currentDayLabel");
    const currentDateLabelEl = document.getElementById("currentDateLabel");
    const exerciseListEl = document.getElementById("exerciseList");
    const completionBadgeEl = document.getElementById("completionBadge");
    const resetDayBtn = document.getElementById("resetDayBtn");

    let currentDay = getDefaultDay();

    function getDefaultDay() {
      const weekday = today.getDay();
      return daysOfWeek[weekday] || "Monday";
    }

    function getStorageKey(day, dateStr) {
      return "workoutProgress_" + day + "_" + dateStr;
    }

    function loadWorkoutProgress(day, dateStr) {
      const key = getStorageKey(day, dateStr);
      const raw = localStorage.getItem(key);
      if (!raw) return {};
      try {
        return JSON.parse(raw);
      } catch {
        return {};
      }
    }

    function saveWorkoutProgress(day, dateStr, progress) {
      const key = getStorageKey(day, dateStr);
      localStorage.setItem(key, JSON.stringify(progress));
    }

    function renderDateLabel() {
      const opts = { weekday: "long", year: "numeric", month: "short", day: "numeric" };
      currentDateLabelEl.textContent = today.toLocaleDateString(undefined, opts);
    }

    function renderDayTabs() {
      dayTabsEl.innerHTML = "";
      Object.keys(workoutPlan).forEach(day => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = day.slice(0, 3);
        btn.className = "day-tab" + (day === currentDay ? " active" : "");
        btn.addEventListener("click", () => {
          currentDay = day;
          renderWorkoutView();
        });
        dayTabsEl.appendChild(btn);
      });
    }

    function countCompleted(total, progressObj) {
      let c = 0;
      for (let i = 0; i < total; i++) {
        const st = progressObj[String(i)];
        if (st && st.done) c++;
      }
      return c;
    }

    function updateCompletionBadge(total, completed) {
      if (total === 0) {
        completionBadgeEl.textContent = "No workout set";
        completionBadgeEl.className = "chip chip-danger";
        return;
      }
      if (completed >= total) {
        completionBadgeEl.textContent = "All done ✔";
        completionBadgeEl.className = "chip chip-success";
      } else {
        completionBadgeEl.textContent = `${completed}/${total} done`;
        completionBadgeEl.className = "chip chip-danger";
      }
    }

    function renderExercises() {
      const exercises = workoutPlan[currentDay] || [];
      const progress = loadWorkoutProgress(currentDay, todayDateStr);
      exerciseListEl.innerHTML = "";

      let completedCount = 0;

      exercises.forEach((ex, index) => {
        const exKey = String(index);
        const exState = progress[exKey] || { done: false, weight: "", notes: "" };
        if (exState.done) completedCount++;

        const wrapper = document.createElement("div");
        wrapper.className = "exercise";

        const header = document.createElement("div");
        header.className = "exercise-header";

        const nameDiv = document.createElement("div");
        nameDiv.innerHTML = `
          <div class="exercise-name">${ex.name}</div>
          <div class="exercise-info">${ex.sets} sets • ${ex.reps}</div>
        `;

        const doneDiv = document.createElement("label");
        doneDiv.className = "done-toggle";
        const doneCheckbox = document.createElement("input");
        doneCheckbox.type = "checkbox";
        doneCheckbox.checked = !!exState.done;
        const doneSpan = document.createElement("span");
        doneSpan.textContent = "Done";

        doneDiv.appendChild(doneCheckbox);
        doneDiv.appendChild(doneSpan);

        header.appendChild(nameDiv);
        header.appendChild(doneDiv);

        const controls = document.createElement("div");
        controls.className = "exercise-controls";

        const weightGroup = document.createElement("div");
        weightGroup.className = "form-group";
        const weightLabel = document.createElement("label");
        weightLabel.textContent = "Weight / Level";
        const weightInput = document.createElement("input");
        weightInput.type = "text";
        weightInput.value = exState.weight || "";
        weightInput.placeholder = "e.g. 15 lb DBs";

        weightGroup.appendChild(weightLabel);
        weightGroup.appendChild(weightInput);

        const notesGroup = document.createElement("div");
        notesGroup.className = "form-group";
        const notesLabel = document.createElement("label");
        notesLabel.textContent = "Notes";
        const notesInput = document.createElement("textarea");
        notesInput.value = exState.notes || "";
        notesInput.placeholder = "How it felt, tweaks, etc.";

        notesGroup.appendChild(notesLabel);
        notesGroup.appendChild(notesInput);

        controls.appendChild(weightGroup);
        controls.appendChild(notesGroup);

        function updateState() {
          const newState = loadWorkoutProgress(currentDay, todayDateStr);
          newState[exKey] = {
            done: doneCheckbox.checked,
            weight: weightInput.value || "",
            notes: notesInput.value || ""
          };
          saveWorkoutProgress(currentDay, todayDateStr, newState);
          updateCompletionBadge(exercises.length, countCompleted(exercises.length, newState));
        }

        doneCheckbox.addEventListener("change", updateState);
        weightInput.addEventListener("change", updateState);
        notesInput.addEventListener("change", updateState);
        notesInput.addEventListener("blur", updateState);

        wrapper.appendChild(header);
        wrapper.appendChild(controls);
        exerciseListEl.appendChild(wrapper);
      });

      updateCompletionBadge(exercises.length, completedCount);
    }

    function renderWorkoutView() {
      renderDayTabs();
      currentDayLabelEl.textContent = currentDay + " workout";
      renderExercises();
    }

    resetDayBtn.addEventListener("click", () => {
      if (!confirm(`Reset all progress for ${currentDay} (today only)?`)) return;
      saveWorkoutProgress(currentDay, todayDateStr, {});
      renderExercises();
    });

    // ==== 4. Progress (measurements) view ====
    const progressDateInput = document.getElementById("progressDate");
    const weightInputEl = document.getElementById("weightInput");
    const waistInputEl = document.getElementById("waistInput");
    const hipsInputEl = document.getElementById("hipsInput");
    const chestInputEl = document.getElementById("chestInput");
    const rArmInputEl = document.getElementById("rArmInput");
    const lArmInputEl = document.getElementById("lArmInput");
    const saveProgressBtn = document.getElementById("saveProgressBtn");
    const recentProgressListEl = document.getElementById("recentProgressList");

    function getMeasurementsKey() {
      return "measurementsLog";
    }

    function loadMeasurements() {
      const raw = localStorage.getItem(getMeasurementsKey());
      if (!raw) return {};
      try { return JSON.parse(raw); } catch { return {}; }
    }

    function saveMeasurements(data) {
      localStorage.setItem(getMeasurementsKey(), JSON.stringify(data));
    }

    function initProgressForm() {
      progressDateInput.value = todayDateStr;
      const all = loadMeasurements();
      const entry = all[todayDateStr];
      if (entry) {
        weightInputEl.value = entry.weight ?? "";
        waistInputEl.value = entry.waist ?? "";
        hipsInputEl.value = entry.hips ?? "";
        chestInputEl.value = entry.chest ?? "";
        rArmInputEl.value = entry.rArm ?? "";
        lArmInputEl.value = entry.lArm ?? "";
      }
      renderRecentProgress();
    }

    function renderRecentProgress() {
      const all = loadMeasurements();
      const entries = Object.entries(all)
        .sort((a,b) => a[0] < b[0] ? 1 : -1) // newest first
        .slice(0, 10);

      if (entries.length === 0) {
        recentProgressListEl.innerHTML = '<div class="subtext">No measurements logged yet.</div>';
        return;
      }

      let html = '<div class="subtext" style="margin-bottom:4px;">Recent entries</div>';
      entries.forEach(([date, data]) => {
        const parts = [];
        if (data.weight) parts.push(`${data.weight} lb`);
        if (data.waist) parts.push(`Waist ${data.waist}"`);
        html += `
          <div class="recent-item">
            <div>
              <span class="key">${date}</span>
            </div>
            <div>${parts.join(" · ")}</div>
          </div>`;
      });
      recentProgressListEl.innerHTML = html;
    }

    saveProgressBtn.addEventListener("click", () => {
      const date = progressDateInput.value || todayDateStr;
      const all = loadMeasurements();
      all[date] = {
        weight: weightInputEl.value || "",
        waist: waistInputEl.value || "",
        hips: hipsInputEl.value || "",
        chest: chestInputEl.value || "",
        rArm: rArmInputEl.value || "",
        lArm: lArmInputEl.value || ""
      };
      saveMeasurements(all);
      renderRecentProgress();
      alert("Saved!");
    });

    // ==== 5. Week summary view ====
    const weekRangeLabelEl = document.getElementById("weekRangeLabel");
    const statWorkoutDaysEl = document.getElementById("statWorkoutDays");
    const statTotalExercisesEl = document.getElementById("statTotalExercises");
    const statLatestWeightEl = document.getElementById("statLatestWeight");
    const statWeightChangeEl = document.getElementById("statWeightChange");
    const statLatestWaistEl = document.getElementById("statLatestWaist");
    const weekDayBreakdownEl = document.getElementById("weekDayBreakdown");

    function getStartOfWeek(d) {
      const date = new Date(d);
      const day = date.getDay(); // 0=Sun
      const diff = (day + 6) % 7; // days since Monday
      date.setDate(date.getDate() - diff);
      date.setHours(0,0,0,0);
      return date;
    }

    function getWeekDates(refDate) {
      const start = getStartOfWeek(refDate);
      const dates = [];
      for (let i = 0; i < 7; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);
        dates.push(d);
      }
      return dates;
    }

    function computeWeekWorkoutStats() {
      const weekDates = getWeekDates(today);
      let workoutDays = 0;
      let totalExercisesDone = 0;
      const breakdown = [];

      weekDates.forEach(d => {
        const dateStr = toDateStr(d);
        const dayName = daysOfWeek[d.getDay()];
        const exercises = workoutPlan[dayName] || [];
        const total = exercises.length;
        let completed = 0;

        if (total > 0) {
          const key = getStorageKey(dayName, dateStr);
          const raw = localStorage.getItem(key);
          if (raw) {
            try {
              const progress = JSON.parse(raw);
              completed = countCompleted(total, progress);
            } catch { completed = 0; }
          }
        }

        if (completed > 0) workoutDays++;
        totalExercisesDone += completed;

        breakdown.push({
          dayLabel: dayName.slice(0,3),
          dateStr,
          completed,
          total
        });
      });

      return { weekDates, workoutDays, totalExercisesDone, breakdown };
    }

    function computeWeightStats() {
      const all = loadMeasurements();
      const entries = Object.entries(all).sort((a,b) => a[0] < b[0] ? -1 : 1); // oldest..newest
      if (entries.length === 0) return null;

      const latest = entries[entries.length-1];
      const latestDate = latest[0];
      const latestData = latest[1];

      // find approx 7-days-ago entry (or oldest)
      let baseline = entries[0];
      const sevenDaysAgo = new Date();
      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
      const sevenStr = toDateStr(sevenDaysAgo);
      for (const [d, data] of entries) {
        if (d >= sevenStr) {
          baseline = [d, data];
          break;
        }
      }

      return { latestDate, latestData, baselineDate: baseline[0], baselineData: baseline[1] };
    }

    function renderWeekSummaryView() {
      const { weekDates, workoutDays, totalExercisesDone, breakdown } = computeWeekWorkoutStats();

      const startStr = weekDates[0].toLocaleDateString(undefined, { month: "short", day: "numeric" });
      const endStr = weekDates[6].toLocaleDateString(undefined, { month: "short", day: "numeric" });
      weekRangeLabelEl.textContent = `${startStr} – ${endStr}`;

      statWorkoutDaysEl.textContent = `${workoutDays}/7`;
      statTotalExercisesEl.textContent = String(totalExercisesDone);

      // weight stats
      const ws = computeWeightStats();
      if (!ws || !ws.latestData.weight) {
        statLatestWeightEl.textContent = "–";
        statWeightChangeEl.textContent = "Add weight entries on Progress tab.";
      } else {
        const latest = parseFloat(ws.latestData.weight);
        statLatestWeightEl.textContent = `${latest.toFixed(1)} lb`;
        if (ws.baselineData && ws.baselineData.weight && ws.baselineData !== ws.latestData) {
          const base = parseFloat(ws.baselineData.weight);
          if (!isNaN(base) && base !== latest) {
            const diff = latest - base;
            const sign = diff > 0 ? "+" : "";
            statWeightChangeEl.textContent = `${sign}${diff.toFixed(1)} lb vs ~7 days ago`;
          } else {
            statWeightChangeEl.textContent = "No change vs last week.";
          }
        } else {
          statWeightChangeEl.textContent = "Only one weight entry so far.";
        }
      }

      if (ws && ws.latestData.waist) {
        statLatestWaistEl.textContent = `${parseFloat(ws.latestData.waist).toFixed(1)}"`;
      } else {
        statLatestWaistEl.textContent = "–";
      }

      // breakdown rows
      let html = "";
      breakdown.forEach(item => {
        const statusTag = item.completed > 0
          ? `<span class="tag-complete">Done</span>`
          : `<span class="tag-miss">Rest / missed</span>`;

        html += `
          <div class="summary-week-row">
            <div>
              <div class="day">${item.dayLabel}</div>
              <div class="count">${item.completed}/${item.total || 0} exercises</div>
            </div>
            <div>${statusTag}</div>
          </div>
        `;
      });
      weekDayBreakdownEl.innerHTML = html;
    }

    // ==== 6. Top nav switching ====
    const navTabs = document.querySelectorAll(".nav-tab");
    const views = {
      workout: document.getElementById("view-workout"),
      progress: document.getElementById("view-progress"),
      summary: document.getElementById("view-summary")
    };

    function setActiveView(viewName) {
      navTabs.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.view === viewName);
      });
      Object.entries(views).forEach(([name, el]) => {
        el.classList.toggle("active", name === viewName);
      });

      if (viewName === "progress") {
        initProgressForm();
      } else if (viewName === "summary") {
        renderWeekSummaryView();
      }
    }

    navTabs.forEach(btn => {
      btn.addEventListener("click", () => setActiveView(btn.dataset.view));
    });

    // ==== 7. Initial render ====
    renderDateLabel();
    renderWorkoutView();
    // progress/summary are rendered when their tabs are opened
  </script>
</body>
</html>










